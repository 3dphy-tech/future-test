void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});
var TWEEN=TWEEN||function(){var a=[];return{REVISION:"14",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){b=a.indexOf(b);-1!==b&&a.splice(b,1)},update:function(b){if(0===a.length)return!1;var c=0;for(b=void 0!==b?b:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();c<a.length;)a[c].update(b)?c++:a.splice(c,1);return!0}}}();
TWEEN.Tween=function(a){var b={},c={},d={},f=1E3,e=0,g=!1,h=!1,k=0,l=null,n=TWEEN.Easing.Linear.None,q=TWEEN.Interpolation.Linear,r=[],m=null,t=!1,p=null,y=null,w=null,z;for(z in a)b[z]=parseFloat(a[z],10);this.to=function(a,b){void 0!==b&&(f=b);c=a;return this};this.start=function(f){TWEEN.add(this);h=!0;t=!1;l=void 0!==f?f:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();l+=k;for(var e in c){if(c[e]instanceof Array){if(0===
c[e].length)continue;c[e]=[a[e]].concat(c[e])}b[e]=a[e];!1===b[e]instanceof Array&&(b[e]*=1);d[e]=b[e]||0}return this};this.stop=function(){if(!h)return this;TWEEN.remove(this);h=!1;null!==w&&w.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,b=r.length;a<b;a++)r[a].stop()};this.delay=function(a){k=a;return this};this.repeat=function(a){e=a;return this};this.yoyo=function(a){g=a;return this};this.easing=function(a){n=a;return this};this.interpolation=function(a){q=
a;return this};this.chain=function(){r=arguments;return this};this.onStart=function(a){m=a;return this};this.onUpdate=function(a){p=a;return this};this.onComplete=function(a){y=a;return this};this.onStop=function(a){w=a;return this};this.update=function(h){var u;if(h<l)return!0;!1===t&&(null!==m&&m.call(a),t=!0);var v=(h-l)/f,v=1<v?1:v,z=n(v);for(u in c){var w=b[u]||0,B=c[u];B instanceof Array?a[u]=q(B,z):("string"===typeof B&&(B=w+parseFloat(B,10)),"number"===typeof B&&(a[u]=w+(B-w)*z))}null!==p&&
p.call(a,z);if(1==v)if(0<e){isFinite(e)&&e--;for(u in d)"string"===typeof c[u]&&(d[u]+=parseFloat(c[u],10)),g&&(v=d[u],d[u]=c[u],c[u]=v),b[u]=d[u];l=h+k}else{null!==y&&y.call(a);u=0;for(v=r.length;u<v;u++)r[u].start(h);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*
a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-
a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return-(c*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4))},Out:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/.4)+1},InOut:function(a){var b,
c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return 1>(a*=2)?-.5*c*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4):c*Math.pow(2,-10*--a)*Math.sin(2*(a-b)*Math.PI/.4)*.5+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<
1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*a-1)+.5}}};
TWEEN.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,f=Math.floor(d),e=TWEEN.Interpolation.Utils.Linear;return 0>b?e(a[0],a[1],d):1<b?e(a[c],a[c-1],c-d):e(a[f],a[f+1>c?c:f+1],d-f)},Bezier:function(a,b){var c=0,d=a.length-1,f=Math.pow,e=TWEEN.Interpolation.Utils.Bernstein,g;for(g=0;g<=d;g++)c+=f(1-b,d-g)*f(b,g)*a[g]*e(d,g);return c},CatmullRom:function(a,b){var c=a.length-1,d=c*b,f=Math.floor(d),e=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(f=Math.floor(d=c*(1+b))),e(a[(f-
1+c)%c],a[f],a[(f+1)%c],a[(f+2)%c],d-f)):0>b?a[0]-(e(a[0],a[0],a[1],a[1],-d)-a[0]):1<b?a[c]-(e(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):e(a[f?f-1:0],a[f],a[c<f+1?c:f+1],a[c<f+2?c:f+2],d-f)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c=1,d;if(a[b])return a[b];for(d=b;1<d;d--)c*=d;return a[b]=c}}(),CatmullRom:function(a,b,c,d,f){a=.5*(c-a);d=.5*(d-b);var e=f*
f;return(2*b-2*c+a+d)*f*e+(-3*b+3*c-2*a-d)*e+a*f+b}}};(function(a,b,c,d){function f(a,b,d){return setTimeout(n(a,d),b)}function e(a,b,d){return Array.isArray(a)?(g(a,d[b],d),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;){if(!c||c&&a[e[f]]===d)a[e[f]]=b[e[f]];f++}return a}function k(a,b){return h(a,b,!0)}function l(a,b,d){b=b.prototype;var c;c=a.prototype=Object.create(b);
c.constructor=a;c._super=b;d&&h(c,d)}function n(a,b){return function(){return a.apply(b,arguments)}}function q(a,b){return"function"==typeof a?a.apply(b?b[0]||d:d,b):a}function r(a,b,c){g(p(b),function(b){a.addEventListener(b,c,!1)})}function m(a,b,c){g(p(b),function(b){a.removeEventListener(b,c,!1)})}function t(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a){return a.trim().split(/\s+/g)}function y(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==
b||!c&&a[d]===b)return d;d++}return-1}function w(a){return Array.prototype.slice.call(a,0)}function z(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];0>y(e,g)&&d.push(a[f]);e[f]=g;f++}c&&(d=b?d.sort(function(a,d){return a[b]>d[b]}):d.sort());return d}function x(a,b){for(var c,e=b[0].toUpperCase()+b.slice(1),f=0;f<X.length;){c=(c=X[f])?c+e:b;if(c in a)return c;f++}return d}function u(a){a=a.ownerDocument;return a.defaultView||a.parentWindow}function v(a,b){var c=this;this.manager=a;
this.callback=b;this.element=a.element;this.target=a.options.inputTarget;this.domHandler=function(b){q(a.options.enable,[a])&&c.handler(b)};this.init()}function ja(a){var b=a.options.inputClass;return new (b?b:la?N:ma?G:Y?O:H)(a,ka)}function ka(a,b,c){var e=c.pointers.length,f=c.changedPointers.length,g=b&1&&0===e-f;c.isFirst=!!g;c.isFinal=!!(b&12&&0===e-f);g&&(a.session={});c.eventType=b;b=a.session;e=c.pointers;f=e.length;b.firstInput||(b.firstInput=B(c));1<f&&!b.firstMultiple?b.firstMultiple=B(c):
1===f&&(b.firstMultiple=!1);var g=b.firstInput,h=(f=b.firstMultiple)?f.center:g.center,k=c.center=Z(e);c.timeStamp=P();c.deltaTime=c.timeStamp-g.timeStamp;c.angle=Q(h,k);c.distance=I(h,k);var g=c.center,h=b.offsetDelta||{},k=b.prevDelta||{},l=b.prevInput||{};if(1===c.eventType||4===l.eventType)k=b.prevDelta={x:l.deltaX||0,y:l.deltaY||0},h=b.offsetDelta={x:g.x,y:g.y};c.deltaX=k.x+(g.x-h.x);c.deltaY=k.y+(g.y-h.y);c.offsetDirection=aa(c.deltaX,c.deltaY);f?(g=f.pointers,g=I(e[0],e[1],J)/I(g[0],g[1],J)):
g=1;c.scale=g;f?(f=f.pointers,e=Q(e[1],e[0],J)-Q(f[1],f[0],J)):e=0;c.rotation=e;h=b.lastInterval||c;e=c.timeStamp-h.timeStamp;8!=c.eventType&&(25<e||h.velocity===d)?(g=h.deltaX-c.deltaX,h=h.deltaY-c.deltaY,k=g/e||0,l=h/e||0,e=k,f=l,k=F(k)>F(l)?k:l,g=aa(g,h),b.lastInterval=c):(k=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction);c.velocity=k;c.velocityX=e;c.velocityY=f;c.direction=g;b=a.element;t(c.srcEvent.target,b)&&(b=c.srcEvent.target);c.target=b;a.emit("hammer.input",c);a.recognize(c);a.session.prevInput=
c}function B(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:E(a.pointers[c].clientX),clientY:E(a.pointers[c].clientY)},c++;return{timeStamp:P(),pointers:b,center:Z(b),deltaX:a.deltaX,deltaY:a.deltaY}}function Z(a){var b=a.length;if(1===b)return{x:E(a[0].clientX),y:E(a[0].clientY)};for(var c=0,d=0,e=0;e<b;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:E(c/b),y:E(d/b)}}function aa(a,b){return a===b?1:F(a)>=F(b)?0<a?2:4:0<b?8:16}function I(a,b,c){c||(c=ba);var d=b[c[0]]-a[c[0]];a=b[c[1]]-a[c[1]];
return Math.sqrt(d*d+a*a)}function Q(a,b,c){c||(c=ba);return 180*Math.atan2(b[c[1]]-a[c[1]],b[c[0]]-a[c[0]])/Math.PI}function H(){this.evEl=na;this.evWin=oa;this.allow=!0;this.pressed=!1;v.apply(this,arguments)}function N(){this.evEl=ca;this.evWin=da;v.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}function ea(){this.evTarget="touchstart";this.evWin="touchstart touchmove touchend touchcancel";this.started=!1;v.apply(this,arguments)}function G(){this.evTarget=pa;this.targetIds=
{};v.apply(this,arguments)}function qa(a,b){var c=w(a.touches),d=this.targetIds;if(b&3&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f=w(a.changedTouches),g=[],h=this.target;e=c.filter(function(a){return t(a.target,h)});if(1===b)for(c=0;c<e.length;)d[e[c].identifier]=!0,c++;for(c=0;c<f.length;)d[f[c].identifier]&&g.push(f[c]),b&12&&delete d[f[c].identifier],c++;if(g.length)return[z(e.concat(g),"identifier",!0),g]}function O(){v.apply(this,arguments);var a=n(this.handler,this);this.touch=
new G(this.manager,a);this.mouse=new H(this.manager,a)}function R(a,b){this.manager=a;this.set(b)}function ra(a){if(-1<a.indexOf("none"))return"none";var b=-1<a.indexOf("pan-x"),c=-1<a.indexOf("pan-y");return b&&c?"pan-x pan-y":b||c?b?"pan-x":"pan-y":-1<a.indexOf("manipulation")?"manipulation":"auto"}function C(a){this.id=sa++;this.manager=null;this.options=k(a||{},this.defaults);a=this.options.enable;this.options.enable=a===d?!0:a;this.state=1;this.simultaneous={};this.requireFail=[]}function fa(a){return 16==
a?"down":8==a?"up":2==a?"left":4==a?"right":""}function K(a,b){var c=b.manager;return c?c.get(a):a}function A(){C.apply(this,arguments)}function L(){A.apply(this,arguments);this.pY=this.pX=null}function S(){A.apply(this,arguments)}function T(){C.apply(this,arguments);this._input=this._timer=null}function U(){A.apply(this,arguments)}function V(){A.apply(this,arguments)}function M(){C.apply(this,arguments);this.pCenter=this.pTime=!1;this._input=this._timer=null;this.count=0}function D(a,b){b=b||{};
var c=b.recognizers;b.recognizers=c===d?D.defaults.preset:c;return new W(a,b)}function W(a,b){b=b||{};this.options=k(b,D.defaults);this.options.inputTarget=this.options.inputTarget||a;this.handlers={};this.session={};this.recognizers=[];this.element=a;this.input=ja(this);this.touchAction=new R(this,this.options.touchAction);ga(this,!0);g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]);a[3]&&b.requireFailure(a[3])},this)}function ga(a,b){var c=a.element;g(a.options.cssProps,
function(a,d){c.style[x(c.style,d)]=b?a:""})}function ta(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0);d.gesture=c;c.target.dispatchEvent(d)}var X=" webkit moz MS ms o".split(" "),ua=b.createElement("div"),E=Math.round,F=Math.abs,P=Date.now,sa=1,va=/mobile|tablet|ip(ad|hone|od)|android/i,Y="ontouchstart"in a,la=x(a,"PointerEvent")!==d,ma=Y&&va.test(navigator.userAgent),ba=["x","y"],J=["clientX","clientY"];v.prototype={handler:function(){},init:function(){this.evEl&&r(this.element,this.evEl,
this.domHandler);this.evTarget&&r(this.target,this.evTarget,this.domHandler);this.evWin&&r(u(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&m(this.element,this.evEl,this.domHandler);this.evTarget&&m(this.target,this.evTarget,this.domHandler);this.evWin&&m(u(this.element),this.evWin,this.domHandler)}};var wa={mousedown:1,mousemove:2,mouseup:4},na="mousedown",oa="mousemove mouseup";l(H,v,{handler:function(a){var b=wa[a.type];b&1&&0===a.button&&(this.pressed=!0);b&2&&1!==a.which&&
(b=4);this.pressed&&this.allow&&(b&4&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:"mouse",srcEvent:a}))}});var xa={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},ya={2:"touch",3:"pen",4:"mouse",5:"kinect"},ca="pointerdown",da="pointermove pointerup pointercancel";a.MSPointerEvent&&(ca="MSPointerDown",da="MSPointerMove MSPointerUp MSPointerCancel");l(N,v,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",
""),d=xa[d],e=ya[a.pointerType]||a.pointerType,f="touch"==e,g=y(b,a.pointerId,"pointerId");d&1&&(0===a.button||f)?0>g&&(b.push(a),g=b.length-1):d&12&&(c=!0);0>g||(b[g]=a,this.callback(this.manager,d,{pointers:b,changedPointers:[a],pointerType:e,srcEvent:a}),c&&b.splice(g,1))}});var za={touchstart:1,touchmove:2,touchend:4,touchcancel:8};l(ea,v,{handler:function(a){var b=za[a.type];1===b&&(this.started=!0);if(this.started){var c;c=w(a.touches);var d=w(a.changedTouches);b&12&&(c=z(c.concat(d),"identifier",
!0));c=[c,d];b&12&&0===c[0].length-c[1].length&&(this.started=!1);this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",srcEvent:a})}}});var Aa={touchstart:1,touchmove:2,touchend:4,touchcancel:8},pa="touchstart touchmove touchend touchcancel";l(G,v,{handler:function(a){var b=Aa[a.type],c=qa.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",srcEvent:a})}});l(O,v,{handler:function(a,b,c){var d="mouse"==c.pointerType;
if("touch"==c.pointerType)this.mouse.allow=!1;else if(d&&!this.mouse.allow)return;b&12&&(this.mouse.allow=!0);this.callback(a,b,c)},destroy:function(){this.touch.destroy();this.mouse.destroy()}});var ha=x(ua.style,"touchAction"),ia=ha!==d;R.prototype={set:function(a){"compute"==a&&(a=this.compute());ia&&(this.manager.element.style[ha]=a);this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];g(this.manager.recognizers,function(b){q(b.options.enable,
[b])&&(a=a.concat(b.getTouchAction()))});return ra(a.join(" "))},preventDefaults:function(a){if(!ia){var b=a.srcEvent;a=a.offsetDirection;if(this.manager.session.prevented)b.preventDefault();else{var c=this.actions,d=-1<c.indexOf("none"),e=-1<c.indexOf("pan-y"),c=-1<c.indexOf("pan-x");if(d||e&&a&6||c&&a&24)return this.preventSrc(b)}}},preventSrc:function(a){this.manager.session.prevented=!0;a.preventDefault()}};C.prototype={defaults:{},set:function(a){h(this.options,a);this.manager&&this.manager.touchAction.update();
return this},recognizeWith:function(a){if(e(a,"recognizeWith",this))return this;var b=this.simultaneous;a=K(a,this);b[a.id]||(b[a.id]=a,a.recognizeWith(this));return this},dropRecognizeWith:function(a){if(e(a,"dropRecognizeWith",this))return this;a=K(a,this);delete this.simultaneous[a.id];return this},requireFailure:function(a){if(e(a,"requireFailure",this))return this;var b=this.requireFail;a=K(a,this);-1===y(b,a)&&(b.push(a),a.requireFailure(this));return this},dropRequireFailure:function(a){if(e(a,
"dropRequireFailure",this))return this;a=K(a,this);a=y(this.requireFail,a);-1<a&&this.requireFail.splice(a,1);return this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(e){c.manager.emit(c.options.event+(e?d&16?"cancel":d&8?"end":d&4?"move":d&2?"start":"":""),a)}var c=this,d=this.state;8>d&&b(!0);b();8<=d&&b(!0)},tryEmit:function(a){if(this.canEmit())return this.emit(a);this.state=32},canEmit:function(){for(var a=
0;a<this.requireFail.length;){if(!(this.requireFail[a].state&33))return!1;a++}return!0},recognize:function(a){a=h({},a);q(this.options.enable,[this,a])?(this.state&56&&(this.state=1),this.state=this.process(a),this.state&30&&this.tryEmit(a)):(this.reset(),this.state=32)},process:function(a){},getTouchAction:function(){},reset:function(){}};l(A,C,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,
d=b&6;a=this.attrTest(a);return d&&(c&8||!a)?b|16:d||a?c&4?b|8:b&2?b|4:2:32}});l(L,A,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var a=this.options.direction,b=[];a&6&&b.push("pan-y");a&24&&b.push("pan-x");return b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;e&b.direction||(b.direction&6?(e=0===f?1:0>f?2:4,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?1:0>g?8:16,c=g!=this.pY,d=Math.abs(a.deltaY)));a.direction=
e;return c&&d>b.threshold&&e&b.direction},attrTest:function(a){return A.prototype.attrTest.call(this,a)&&(this.state&2||!(this.state&2)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX;this.pY=a.deltaY;var b=fa(a.direction);b&&this.manager.emit(this.options.event+b,a);this._super.emit.call(this,a)}});l(S,A,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||
this.state&2)},emit:function(a){this._super.emit.call(this,a);1!==a.scale&&this.manager.emit(this.options.event+(1>a.scale?"in":"out"),a)}});l(T,C,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,e=a.deltaTime>b.time;this._input=a;if(!d||!c||a.eventType&12&&!e)this.reset();else if(a.eventType&1)this.reset(),this._timer=f(function(){this.state=8;this.tryEmit()},
b.time,this);else if(a.eventType&4)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(a){8===this.state&&(a&&a.eventType&4?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=P(),this.manager.emit(this.options.event,this._input)))}});l(U,A,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&2)}});
l(V,A,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return L.prototype.getTouchAction.call(this)},attrTest:function(a){var b=this.options.direction,c;b&30?c=a.velocity:b&6?c=a.velocityX:b&24&&(c=a.velocityY);return this._super.attrTest.call(this,a)&&b&a.direction&&a.distance>this.options.threshold&&F(c)>this.options.velocity&&a.eventType&4},emit:function(a){var b=fa(a.direction);b&&this.manager.emit(this.options.event+b,a);this.manager.emit(this.options.event,
a)}});l(M,C,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,e=a.deltaTime<b.time;this.reset();if(a.eventType&1&&0===this.count)return this.failTimeout();if(d&&e&&c){if(4!=a.eventType)return this.failTimeout();c=this.pTime?a.timeStamp-this.pTime<b.interval:!0;d=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;
this.pTime=a.timeStamp;this.pCenter=a.center;this.count=d&&c?this.count+1:1;this._input=a;if(0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=f(function(){this.state=8;this.tryEmit()},b.interval,this),2):8}return 32},failTimeout:function(){this._timer=f(function(){this.state=32},this.options.interval,this);return 32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});D.VERSION=
"2.0.4";D.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[U,{enable:!1}],[S,{enable:!1},["rotate"]],[V,{direction:6}],[L,{direction:6},["swipe"]],[M],[M,{event:"doubletap",taps:2},["tap"]],[T]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};W.prototype={set:function(a){h(this.options,a);a.touchAction&&this.touchAction.update();a.inputTarget&&(this.input.destroy(),
this.input.target=a.inputTarget,this.input.init());return this},stop:function(a){this.session.stopped=a?2:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;if(!e||e&&e.state&8)e=b.curRecognizer=null;for(var f=0;f<d.length;)c=d[f],2===b.stopped||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&14&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof C)return a;for(var b=this.recognizers,
c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(e(a,"add",this))return this;var b=this.get(a.options.event);b&&this.remove(b);this.recognizers.push(a);a.manager=this;this.touchAction.update();return a},remove:function(a){if(e(a,"remove",this))return this;var b=this.recognizers;a=this.get(a);b.splice(y(b,a),1);this.touchAction.update();return this},on:function(a,b){var c=this.handlers;g(p(a),function(a){c[a]=c[a]||[];c[a].push(b)});return this},off:function(a,
b){var c=this.handlers;g(p(a),function(a){b?c[a].splice(y(c[a],b),1):delete c[a]});return this},emit:function(a,b){this.options.domEvents&&ta(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a;b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ga(this,!1);this.handlers={};this.session={};this.input.destroy();this.element=null}};h(D,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,
STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:W,Input:v,TouchAction:R,TouchInput:G,MouseInput:H,PointerEventInput:N,TouchMouseInput:O,SingleTouchInput:ea,Recognizer:C,AttrRecognizer:A,Tap:M,Pan:L,Swipe:V,Pinch:S,Rotate:U,Press:T,on:r,off:m,each:g,merge:k,extend:h,inherit:l,bindFn:n,prefixed:x});
"function"==typeof define&&define.amd?define(function(){return D}):"undefined"!=typeof module&&module.exports?module.exports=D:a[c]=D})(window,document,"Hammer");var g_htmlCanvas,g_cRenderer=null,g_cSystemSpecs={},g_cUI=null,g_prevTime=0,g_LEFTKEY=37,g_UPKEY=38,g_RIGHTKEY=39,g_DOWNKEY=40,g_PKEY=80,g_ptPrevPanShift={},g_ptCurrPanShift={},g_ptPrevSwipeShift={},g_ptCurrSwipeShift={},g_cSwipeTween=null,g_fSwipeIsOver=!1;
$(function(){for(var a="local-test",b="",c="",d="",f="",e=window.location.search.substring(1).split("&"),g=0;g<e.length;g++){var h=e[g].split("=");switch(h[0]){case "un":a=h[1];break;case "ic":b=h[1];break;case "ct":c=h[1];break;case "at":d=h[1];break;case "tp":f=h[1]}}e="";switch(a){case "sa":e="https://s3-ap-southeast-1.amazonaws.com/sa-openspace/shulin/";break;case "sa-test":e="https://s3-ap-southeast-1.amazonaws.com/sa-openspace-test/shulin/";break;case "pc":e="https://s3-ap-southeast-1.amazonaws.com/sa-openspace/propcube/";
b=c+"/"+d+"/"+f;break;default:e="./assets/projects/"}a={};a.strStoragePath=e+b+"/";b=getSystemSpecs();g_cSystemSpecs.fIsFullScreen=!1;g_cSystemSpecs.fUseGalaxy=!0;g_cSystemSpecs.strDevType=b[0];g_cSystemSpecs.strOSName=b[1];g_htmlCanvas=document.getElementById("main-canvas");b=getViewport();g_htmlCanvas.width=b[0];g_htmlCanvas.height=b[1];a.width=b[0];a.height=b[1];g_cRenderer=new CRenderer;g_cRenderer.initEngine(g_htmlCanvas);g_cRenderer.setupScene(a);b=new Hammer.Manager(g_htmlCanvas);c=new Hammer.Pan({direction:Hammer.DIRECTION_ALL});
d=new Hammer.Tap({event:"singletap"});b.add([c,d]);registerEvents();b.on("pan singletap",onTouch);g_cUI=new CUI;g_cUI.initialize(a);runProcessLoop()});function runProcessLoop(a){requestAnimationFrame(runProcessLoop);var b=a-g_prevTime;g_prevTime=a;g_cRenderer.animateScene(b);g_cRenderer.displayScene(b)};function CCameraManager(){this.m_cControlProps=this.m_cCamera=this.m_cFloorPlanManipulator=this.m_cWalkthroughManipulator=this.m_cDollHouseManipulator=this.m_cCameraManipulator=this.m_cGlobalSettings=null;this.m_nCameraMode=0}
CCameraManager.prototype={constructor:CCameraManager,initialize:function(a,b){a.cameraManager=this;this.m_cGlobalSettings=a;this.m_cCamera=b;this.m_cDollHouseManipulator=new CDollHouseManipulator;this.m_cDollHouseManipulator.initialize(a,b);this.m_cWalkthroughManipulator=new CWalkthroughManipulator;this.m_cWalkthroughManipulator.initialize(a,b);this.m_cWalkthroughManipulator.setSkyBox(this.m_cGlobalSettings.dataManager.getSkyBox());this.m_cFloorPlanManipulator=new CFloorPlanManipulator;this.m_cFloorPlanManipulator.initialize(a,
b);this.m_cControlProps=a.cControlProps;this.setCameraMode(CAMERAMODE.DOLLHOUSE)},mouseClick:function(a,b){this.m_cCameraManipulator.mouseClick(a,b)},mouseDblClick:function(a,b){this.m_cCameraManipulator.mouseDblClick(a,b)},mouseMove:function(a,b){this.m_cCameraManipulator.mouseMove(a,b)},mouseDrag:function(a,b){this.m_cCameraManipulator.mouseDrag(a,b)},mouseScroll:function(a){this.m_cCameraManipulator.mouseScroll(a)},arrowKeyPressed:function(a){this.m_cCameraManipulator.arrowKeyPressed(a)},setCameraMode:function(a){this.m_nCameraMode=
a;switch(a){case CAMERAMODE.DOLLHOUSE:this.m_cCameraManipulator=this.m_cDollHouseManipulator;this.m_cCameraManipulator.resetView();this.m_cGlobalSettings.dataManager.enableSkyBox(!1);this.m_cGlobalSettings.dataManager.enableRoofNodes(!1);this.m_cWalkthroughManipulator.enableDirectionArrows(!1);break;case CAMERAMODE.FLOORPLAN:this.m_cCameraManipulator=this.m_cFloorPlanManipulator;this.m_cCameraManipulator.resetView();this.m_cGlobalSettings.dataManager.enableSkyBox(!1);this.m_cGlobalSettings.dataManager.enableRoofNodes(!1);
this.m_cWalkthroughManipulator.enableDirectionArrows(!1);break;case CAMERAMODE.WALKTHROUGH:this.m_cCameraManipulator=this.m_cWalkthroughManipulator,this.m_cCameraManipulator.resetView(),this.m_cGlobalSettings.dataManager.enableSkyBox(!0),this.m_cGlobalSettings.dataManager.enableRoofNodes(!0)}},changeCameraMode:function(a){if(this.m_nCameraMode!==a){switch(a){case CAMERAMODE.DOLLHOUSE:this.changeToDollHouse();break;case CAMERAMODE.FLOORPLAN:this.changeToFloorPlan();break;case CAMERAMODE.WALKTHROUGH:this.changeToWalkThrough()}this.m_nCameraMode=
a}},changeToDollHouse:function(){this.animateToDollHouse()},changeToFloorPlan:function(){this.animateToFloorPlan()},changeToWalkThrough:function(){this.animateToWalkthrough()},animateToWalkthrough:function(){var a=this;if(this.m_nCameraMode==CAMERAMODE.DOLLHOUSE){var b=new THREE.Vector3;b.copy(a.m_cCamera.position);var c=a.m_cDollHouseManipulator.getRotationX(),d=a.m_cDollHouseManipulator.getRotationY(),f=b.x,e=b.y,g=b.z,b=THREE.Math.degToRad(a.m_cWalkthroughManipulator.getStartOrientation()),h=THREE.Math.degToRad(0),
k=a.m_cWalkthroughManipulator.getStartPoint().pointCenter,l=k.x,n=k.y,k=k.z,q=a.m_cDollHouseManipulator.getFov(),r=a.m_cWalkthroughManipulator.getFov(),m={posX:f,posY:e,posZ:g,fov:q},f={posX:l,posY:n,posZ:k,fov:r},e=new TWEEN.Tween(m);e.to(f,1E3);e.interpolation(TWEEN.Interpolation.Linear);e.easing(TWEEN.Easing.Quadratic.Out);e.onUpdate(function(){var b=new THREE.Vector3(m.posX,m.posY,m.posZ);a.m_cCamera.fov=m.fov;a.m_cCamera.updateProjectionMatrix();a.m_cCamera.position.copy(b)});e.onComplete(function(){a.m_cGlobalSettings.dataManager.enableSkyBox(!0);
a.m_cGlobalSettings.dataManager.enableRoofNodes(!0)});e.start();var t={rotX:c,rotY:d},f={rotX:h,rotY:b},c=Math.abs(h-c),d=Math.abs(b-d),d=Math.max(c,d),d=d/Math.PI*1200,c=new TWEEN.Tween(t);c.to(f,d);c.delay(600);c.interpolation(TWEEN.Interpolation.Linear);c.easing(TWEEN.Easing.Quadratic.Out);c.onUpdate(function(){a.m_cWalkthroughManipulator.updateRotationWithLonLat(t.rotY,-t.rotX)});c.onComplete(function(){a.m_cCameraManipulator=a.m_cWalkthroughManipulator;a.m_cWalkthroughManipulator.updateSettingsToPoint(0);
a.m_cWalkthroughManipulator.enableDirectionArrows(!0)});c.start()}else this.m_nCameraMode==CAMERAMODE.FLOORPLAN&&(b=new THREE.Vector3,b.copy(a.m_cCamera.position),c=a.m_cFloorPlanManipulator.getDefaultRotationX(),d=a.m_cFloorPlanManipulator.getDefaultRotationY(),f=b.x,e=b.y,g=b.z,b=THREE.Math.degToRad(a.m_cWalkthroughManipulator.getStartOrientation()),h=THREE.Math.degToRad(0),k=a.m_cWalkthroughManipulator.getStartPoint().pointCenter,l=k.x,n=k.y,k=k.z,q=a.m_cFloorPlanManipulator.getFov(),r=a.m_cWalkthroughManipulator.getFov(),
m={posX:f,posY:e,posZ:g,fov:q},f={posX:l,posY:n,posZ:k,fov:r},e=new TWEEN.Tween(m),e.to(f,1E3),e.interpolation(TWEEN.Interpolation.Linear),e.easing(TWEEN.Easing.Quadratic.Out),e.onUpdate(function(){var b=new THREE.Vector3(m.posX,m.posY,m.posZ);a.m_cCamera.fov=m.fov;a.m_cCamera.updateProjectionMatrix();a.m_cCamera.position.copy(b)}),e.onComplete(function(){a.m_cGlobalSettings.dataManager.enableSkyBox(!0);a.m_cGlobalSettings.dataManager.enableRoofNodes(!0)}),e.start(),t={rotX:c,rotY:d},f={rotX:h,rotY:b},
c=Math.abs(h-c),d=Math.abs(b-d),d=Math.max(c,d),d=d/Math.PI*1200,c=new TWEEN.Tween(t),c.to(f,d),c.delay(600),c.interpolation(TWEEN.Interpolation.Linear),c.easing(TWEEN.Easing.Quadratic.Out),c.onUpdate(function(){a.m_cWalkthroughManipulator.updateRotationWithLonLat(t.rotY,-t.rotX)}),c.onComplete(function(){a.m_cCameraManipulator=a.m_cWalkthroughManipulator;a.m_cWalkthroughManipulator.updateSettingsToPoint(0);a.m_cWalkthroughManipulator.enableDirectionArrows(!0)}),c.start())},animateToFloorPlan:function(){var a=
this;if(this.m_nCameraMode==CAMERAMODE.DOLLHOUSE){var b=new THREE.Vector3;b.copy(a.m_cDollHouseManipulator.getViewCenter());var c=a.m_cDollHouseManipulator.getRotationX(),d=a.m_cDollHouseManipulator.getRotationY(),f=a.m_cDollHouseManipulator.getViewSphereRadius(),e=b.x,g=b.y,b=b.z,h=a.m_cFloorPlanManipulator.getDefaultRotationX(),k=a.m_cFloorPlanManipulator.getDefaultRotationY(),l=a.m_cFloorPlanManipulator.getDefaultViewSphereRadius(),n=a.m_cFloorPlanManipulator.getDefaultViewCenter(),q=n.x,r=n.y,
n=n.z,m=a.m_cDollHouseManipulator.getFov(),t=a.m_cFloorPlanManipulator.getFov(),p={rotX:c,rotY:d,radius:f,posX:e,posY:g,posZ:b,fov:m},c={rotX:h,rotY:k,radius:l,posX:q,posY:r,posZ:n,fov:t},d=new TWEEN.Tween(p);d.to(c,1E3);d.interpolation(TWEEN.Interpolation.Linear);d.easing(TWEEN.Easing.Quadratic.Out);d.onUpdate(function(){var b=new THREE.Vector3(p.posX,p.posY,p.posZ);a.m_cCamera.fov=p.fov;a.m_cCamera.updateProjectionMatrix();a.m_cFloorPlanManipulator.updateView(p.rotX,p.rotY,p.radius,b)});d.onComplete(function(){a.m_cCameraManipulator=
a.m_cFloorPlanManipulator});d.start()}else this.m_nCameraMode==CAMERAMODE.WALKTHROUGH&&(a.m_cGlobalSettings.dataManager.enableSkyBox(!1),a.m_cGlobalSettings.dataManager.enableRoofNodes(!1),a.m_cWalkthroughManipulator.enableDirectionArrows(!1),f=new THREE.Vector3,f.copy(a.m_cCamera.position),c=THREE.Math.degToRad(a.m_cWalkthroughManipulator.getLatitude()),d=THREE.Math.degToRad(a.m_cWalkthroughManipulator.getLongitude()),e=f.x,g=f.y,b=f.z,f=1,h=a.m_cFloorPlanManipulator.getDefaultRotationX(),k=a.m_cFloorPlanManipulator.getDefaultRotationY(),
l=a.m_cFloorPlanManipulator.getDefaultViewSphereRadius(),n=a.m_cFloorPlanManipulator.getDefaultViewCenter(),q=n.x,r=n.y,n=n.z,m=a.m_cWalkthroughManipulator.getFov(),t=a.m_cFloorPlanManipulator.getFov(),p={rotX:c,rotY:d,radius:f,posX:e,posY:g,posZ:b,fov:m},c={rotX:h,rotY:k,radius:l,posX:q,posY:r,posZ:n,fov:t},d=new TWEEN.Tween(p),d.to(c,1500),d.interpolation(TWEEN.Interpolation.Linear),d.easing(TWEEN.Easing.Quadratic.Out),d.onUpdate(function(){var b=new THREE.Vector3(p.posX,p.posY,p.posZ);a.m_cCamera.fov=
p.fov;a.m_cCamera.updateProjectionMatrix();a.m_cFloorPlanManipulator.updateView(p.rotX,p.rotY,p.radius,b)}),d.onComplete(function(){a.m_cCameraManipulator=a.m_cFloorPlanManipulator}),d.start())},animateToDollHouse:function(){var a=this;if(this.m_nCameraMode==CAMERAMODE.FLOORPLAN){var b=new THREE.Vector3;b.copy(a.m_cFloorPlanManipulator.getViewCenter());var c=a.m_cFloorPlanManipulator.getRotationX(),d=a.m_cFloorPlanManipulator.getRotationY(),f=a.m_cFloorPlanManipulator.getViewSphereRadius(),e=b.x,
g=b.y,b=b.z,h=a.m_cDollHouseManipulator.getDefaultRotationX(),k=a.m_cDollHouseManipulator.getDefaultRotationY(),l=a.m_cDollHouseManipulator.getDefaultViewSphereRadius(),n=a.m_cDollHouseManipulator.getDefaultViewCenter(),q=n.x,r=n.y,n=n.z,m=a.m_cFloorPlanManipulator.getFov(),t=a.m_cDollHouseManipulator.getFov(),p={rotX:c,rotY:d,radius:f,posX:e,posY:g,posZ:b,fov:m},c={rotX:h,rotY:k,radius:l,posX:q,posY:r,posZ:n,fov:t},d=new TWEEN.Tween(p);d.to(c,1E3);d.interpolation(TWEEN.Interpolation.Linear);d.easing(TWEEN.Easing.Quadratic.Out);
d.onUpdate(function(){var b=new THREE.Vector3(p.posX,p.posY,p.posZ);a.m_cCamera.fov=p.fov;a.m_cCamera.updateProjectionMatrix();a.m_cDollHouseManipulator.updateView(p.rotX,p.rotY,p.radius,b)});d.onComplete(function(){a.m_cCameraManipulator=a.m_cDollHouseManipulator});d.start()}else this.m_nCameraMode==CAMERAMODE.WALKTHROUGH&&(a.m_cGlobalSettings.dataManager.enableSkyBox(!1),a.m_cGlobalSettings.dataManager.enableRoofNodes(!1),a.m_cWalkthroughManipulator.enableDirectionArrows(!1),f=new THREE.Vector3,
f.copy(a.m_cCamera.position),c=THREE.Math.degToRad(a.m_cWalkthroughManipulator.getLatitude()),d=THREE.Math.degToRad(a.m_cWalkthroughManipulator.getLongitude()),e=f.x,g=f.y,b=f.z,f=1,h=a.m_cDollHouseManipulator.getDefaultRotationX(),k=a.m_cDollHouseManipulator.getDefaultRotationY(),l=a.m_cDollHouseManipulator.getDefaultViewSphereRadius(),n=a.m_cDollHouseManipulator.getDefaultViewCenter(),q=n.x,r=n.y,n=n.z,m=a.m_cWalkthroughManipulator.getFov(),t=a.m_cDollHouseManipulator.getFov(),p={rotX:c,rotY:d,
radius:f,posX:e,posY:g,posZ:b,fov:m},c={rotX:h,rotY:k,radius:l,posX:q,posY:r,posZ:n,fov:t},d=new TWEEN.Tween(p),d.to(c,1500),d.interpolation(TWEEN.Interpolation.Linear),d.easing(TWEEN.Easing.Quadratic.Out),d.onUpdate(function(){var b=new THREE.Vector3(p.posX,p.posY,p.posZ);a.m_cCamera.fov=p.fov;a.m_cCamera.updateProjectionMatrix();a.m_cDollHouseManipulator.updateView(p.rotX,p.rotY,p.radius,b)}),d.onComplete(function(){a.m_cCameraManipulator=a.m_cDollHouseManipulator}),d.start())},getDirectionArrowContainer:function(){return this.m_cWalkthroughManipulator.getDirectionArrowContainer()},
updateAnimation:function(a){this.m_cCameraManipulator.updateAnimation(a)},enableAutoTour:function(a){this.m_cCameraManipulator.enableAutoTour(a)},updateTourMode:function(a){this.m_cCameraManipulator.updateTourMode(TourMode.AUTO)},isAutoTourEnabled:function(){return this.m_cCameraManipulator.isAutoTourEnabled()},moveToPoint:function(a){return this.m_cWalkthroughManipulator.moveToPoint(a)}};function CDataManager(){this.m_aUnits=[];this.m_a3DObjectContainer=null;this.m_nCurrentUnitIndex=0}
CDataManager.prototype={constructor:CDataManager,initialize:function(a){a.dataManager=this;this.loadData(a);this.m_a3DObjectContainer=new THREE.Object3D;this.load3DObjects()},loadData:function(a){var b=parseUnitProps(a.strStoragePath+"UnitProps.json");if(b){a.cUnitProps=b;for(var c=0;c<b.units.length;c++){var d=new CUnit;d.initialize(a,c);this.m_aUnits[c]=d}}},load3DObjects:function(){for(var a=0;a<this.m_aUnits.length;a++)this.m_a3DObjectContainer.add(this.m_aUnits[a].get3DObjects())},get3DObjects:function(){return this.m_a3DObjectContainer},
getSkyBox:function(){return this.m_aUnits[this.m_nCurrentUnitIndex].getSkyBox()},enableSkyBox:function(a){this.m_aUnits[this.m_nCurrentUnitIndex].enableSkyBox(a)},enableRoofNodes:function(a){this.m_aUnits[this.m_nCurrentUnitIndex].enableRoofNodes(a)}};function CDollHouseManipulator(){this.m_rViewSphereRadius=this.m_cViewCenter=this.m_cModelCenter=this.m_cCamera=this.m_cGlobalSettings=null;this.m_rDefaultRotationY=this.m_rDefaultRotationX=this.m_rRotationY=this.m_rRotationX=0;this.m_cDefaultViewCenter=this.m_rDefaultViewSphereRadius=null;this.m_rZoomDefault=1;this.m_fLimitMove=!0;this.m_cControlProps=null;this.m_fRadiusInTransit=!1;this.m_rZoomFactor=1.25;this.m_cZoomTweenObject=null;this.m_rFov=35}
CDollHouseManipulator.prototype={constructor:CDollHouseManipulator,initialize:function(a,b){this.m_cCamera=b;this.m_cControlProps=a.cControlProps;var c=1E3;this.m_cGlobalSettings=a;var d=new THREE.Vector3(this.m_cControlProps.modelParams.box.min.x,this.m_cControlProps.modelParams.box.min.y,this.m_cControlProps.modelParams.box.min.z),f=new THREE.Vector3(this.m_cControlProps.modelParams.box.max.x,this.m_cControlProps.modelParams.box.max.y,this.m_cControlProps.modelParams.box.max.z),d=new THREE.Box3(d,
f);this.m_cDefaultViewCenter=new THREE.Vector3(this.m_cControlProps.modelParams.centroid.x,this.m_cControlProps.modelParams.centroid.y,this.m_cControlProps.modelParams.centroid.z);this.m_cViewCenter=new THREE.Vector3;this.m_cViewCenter.copy(this.m_cDefaultViewCenter);d=d.size();d.x>=d.y&&d.x>=d.z?c=d.x:d.y>=d.x&&d.y>=d.z?c=d.y:d.z>=d.y&&d.z>=d.y&&(c=d.z);f=a.height>a.width?2*Math.atan(Math.tan(THREE.Math.degToRad(this.m_cCamera.fov)/2)*a.width/a.height):THREE.Math.degToRad(this.m_cCamera.fov);this.m_rZoomDefault=
1*(c/2/Math.tan(f/2)+d.z/2);this.m_rDefaultRotationX=THREE.Math.degToRad(this.m_cControlProps.dollhouse.flyPoints[0].rotX);this.m_rDefaultRotationY=THREE.Math.degToRad(this.m_cControlProps.dollhouse.flyPoints[0].rotY);this.m_rDefaultViewSphereRadius=this.m_cControlProps.dollhouse.flyPoints[0].radius;this.resetView()},resetView:function(){this.m_rRotationX=this.m_rDefaultRotationX;this.m_rRotationY=this.m_rDefaultRotationY;this.m_rViewSphereRadius=this.m_rDefaultViewSphereRadius;this.m_cViewCenter.copy(this.m_cDefaultViewCenter);
this.m_cCamera.fov=this.m_rFov;this.m_cCamera.updateProjectionMatrix();this.updateCameraPosition()},rotate:function(a,b){this.m_rRotationX+=b*Math.PI/this.m_cGlobalSettings.height;this.m_fLimitMove&&this.m_rRotationX>Math.PI/2?this.m_rRotationX=Math.PI/2-.01:this.m_fLimitMove&&0>this.m_rRotationX&&(this.m_rRotationX=0);this.m_rRotationY+=2*-a*Math.PI/this.m_cGlobalSettings.width;this.m_rRotationY<-Math.PI&&(this.m_rRotationY=Math.PI);this.m_rRotationY>Math.PI&&(this.m_rRotationY=-Math.PI);this.updateCameraPosition()},
updateView:function(a,b,c,d){this.m_rRotationX=a;this.m_fLimitMove&&this.m_rRotationX>Math.PI/2?this.m_rRotationX=Math.PI/2-.01:this.m_fLimitMove&&0>this.m_rRotationX&&(this.m_rRotationX=0);this.m_rRotationY=b;this.m_rViewSphereRadius=c;d&&this.m_cViewCenter.copy(d);this.updateCameraPosition()},zoom:function(a){this.m_fRadiusInTransit&&this.m_cZoomTweenObject.stop();var b=this,c=0;a==g_UPKEY?c=this.m_rViewSphereRadius/this.m_rZoomFactor:a==g_DOWNKEY&&(c=this.m_rViewSphereRadius*this.m_rZoomFactor);
var d={radius:this.m_rViewSphereRadius};a={radius:c};this.m_cZoomTweenObject=new TWEEN.Tween(d);this.m_cZoomTweenObject.delay(0);this.m_cZoomTweenObject.to(a,500);this.m_cZoomTweenObject.interpolation(TWEEN.Interpolation.Linear);this.m_cZoomTweenObject.easing(TWEEN.Easing.Quadratic.Out);this.m_cZoomTweenObject.onUpdate(function(){b.m_rViewSphereRadius=d.radius;b.updateCameraPosition()});this.m_cZoomTweenObject.onComplete(function(){b.m_rViewSphereRadius=d.radius;b.updateCameraPosition();b.m_fRadiusInTransit=
!1});this.m_cZoomTweenObject.start();this.m_fRadiusInTransit=!0},updateCameraPosition:function(){var a=new THREE.Vector3;a.x=this.m_cViewCenter.x+this.m_rViewSphereRadius*Math.cos(this.m_rRotationX)*Math.sin(this.m_rRotationY);a.y=this.m_cViewCenter.y+this.m_rViewSphereRadius*Math.sin(this.m_rRotationX);a.z=this.m_cViewCenter.z+this.m_rViewSphereRadius*Math.cos(this.m_rRotationX)*Math.cos(this.m_rRotationY);this.m_cCamera.position.set(a.x,a.y,a.z);this.m_cCamera.lookAt(this.m_cViewCenter)},mouseClick:function(a,
b){},mouseDblClick:function(a,b){},mouseMove:function(a,b){},mouseDrag:function(a,b){this.rotate(a,b)},mouseScroll:function(a){this.zoom(a)},arrowKeyPressed:function(a){},updateAnimation:function(a){},getRotationX:function(){return this.m_rRotationX},getRotationY:function(){return this.m_rRotationY},getViewSphereRadius:function(){return this.m_rViewSphereRadius},getFov:function(){return this.m_rFov},getViewCenter:function(){return this.m_cViewCenter},getDefaultViewCenter:function(){return this.m_cDefaultViewCenter},
getDefaultRotationX:function(){return this.m_rDefaultRotationX},getDefaultRotationY:function(){return this.m_rDefaultRotationY},getDefaultViewSphereRadius:function(){return this.m_rDefaultViewSphereRadius}};var g_ptPrevPanShift={},g_ptCurrPanShift={},g_ptPrevSwipeShift={},g_ptCurrSwipeShift={},g_cSwipeTween=null,g_fSwipeIsOver=!1,g_rPrevPinchScale=1,g_rCurrPinchScale=1,g_fPinchIsOver=!1;function registerEvents(){g_htmlCanvas.addEventListener("wheel",onMouseWheel,!1);window.addEventListener("resize",onWindowResize,!1);window.addEventListener("keydown",onKeyDown,!0);g_htmlCanvas.addEventListener("mousemove",onMouseMove,!1)}
function onWindowResize(){var a=getViewport();g_htmlCanvas.width=a[0];g_htmlCanvas.height=a[1];g_cRenderer.updateScene(g_htmlCanvas)}function onContextMenu(a){if(2===a.button)return a.preventDefault(),!1}function onKeyDown(a){switch(a.keyCode){case g_LEFTKEY:case g_RIGHTKEY:case g_UPKEY:case g_DOWNKEY:a.preventDefault();g_cRenderer.arrowKeyPressed(a.keyCode);a.stopPropagation();break;case g_PKEY:g_cRenderer.toggleTourMode(),a.stopPropagation()}}
function onMouseMove(a){g_cRenderer.mouseMove(a.clientX,a.clientY)}function onMouseWheel(a){a.preventDefault();var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail);0<b?g_cRenderer.mouseScroll(g_UPKEY):0>b&&g_cRenderer.mouseScroll(g_DOWNKEY)}
function onTouch(a){if("pinch"==a.type)a.preventDefault(),g_rCurrPinchScale=a.scale,g_cRenderer.modelZoom(5*(g_rCurrPinchScale-g_rPrevPinchScale)),g_rPrevPinchScale=g_rCurrPinchScale,a.eventType===Hammer.INPUT_END&&(g_rPrevPinchScale=1,g_fPinchIsOver=!0);else if("pan"===a.type){a.preventDefault();var b=Math.abs(a.velocity);if(a.eventType===Hammer.INPUT_END&&1<b){g_cSwipeTween&&g_cSwipeTween.stop();var c={x:0,y:0};a={x:Math.max(1,.15*Math.abs(a.velocityX))*a.deltaX,y:Math.max(1,.15*Math.abs(a.velocityY))*
a.deltaY/2};g_ptPrevSwipeShift.x=c.x;g_ptPrevSwipeShift.y=c.y;g_cSwipeTween=(new TWEEN.Tween(c)).to(a,3E3).interpolation(TWEEN.Interpolation.Linear).delay(0).easing(TWEEN.Easing.Exponential.Out).repeat(0).start();g_cSwipeTween.onUpdate(function(){g_ptCurrSwipeShift.x=c.x;g_ptCurrSwipeShift.y=c.y;g_cRenderer.mouseDrag(g_ptCurrSwipeShift.x-g_ptPrevSwipeShift.x,g_ptCurrSwipeShift.y-g_ptPrevSwipeShift.y);g_ptPrevSwipeShift.x=g_ptCurrSwipeShift.x;g_ptPrevSwipeShift.y=g_ptCurrSwipeShift.y});g_fSwipeIsOver=
!0}else{if(void 0===g_ptPrevPanShift.x||void 0===g_ptPrevPanShift.y)g_ptPrevPanShift.x=0,g_ptPrevPanShift.y=0;g_fSwipeIsOver&&(g_cSwipeTween&&g_cSwipeTween.stop(),g_ptPrevPanShift.x=a.deltaX,g_ptPrevPanShift.y=a.deltaY,g_fSwipeIsOver=!1);g_ptCurrPanShift.x=a.deltaX;g_ptCurrPanShift.y=a.deltaY;g_cRenderer.mouseDrag(g_ptCurrPanShift.x-g_ptPrevPanShift.x,g_ptCurrPanShift.y-g_ptPrevPanShift.y);g_ptPrevPanShift.x=g_ptCurrPanShift.x;g_ptPrevPanShift.y=g_ptCurrPanShift.y;a.eventType===Hammer.INPUT_END&&
(g_ptPrevPanShift.x=0,g_ptPrevPanShift.y=0)}}else"singletap"===a.type&&(a.preventDefault(),g_cRenderer.mouseClick(a.center.x,a.center.y))}function gyroDetector(a){a.alpha&&(g_cRenderer.setGyroAvailable(!0),window.removeEventListener("deviceorientation",gyroDetector,!0))};function CFloorPlanManipulator(){this.m_cViewCenter=this.m_cModelCenter=this.m_cCamera=this.m_cGlobalSettings=null;this.m_rZoomDefault=1;this.m_cControlProps=null;this.m_fRadiusInTransit=!1;this.m_rZoomFactor=1.25;this.m_cZoomTweenObject=null;this.m_rRotationY=this.m_rRotationX=0;this.m_rViewSphereRadius=null;this.m_rDefaultRotationY=this.m_rDefaultRotationX=0;this.m_cModelBoxMax=this.m_cModelBoxMin=this.m_cModelDimensions=this.m_cDefaultViewCenter=this.m_rDefaultViewSphereRadius=null;this.m_rFov=
35}
CFloorPlanManipulator.prototype={constructor:CFloorPlanManipulator,initialize:function(a,b){this.m_cCamera=b;this.m_cControlProps=a.cControlProps;var c=1E3;this.m_cGlobalSettings=a;var d=new THREE.Vector3(this.m_cControlProps.modelParams.box.min.x,this.m_cControlProps.modelParams.box.min.y,this.m_cControlProps.modelParams.box.min.z),f=new THREE.Vector3(this.m_cControlProps.modelParams.box.max.x,this.m_cControlProps.modelParams.box.max.y,this.m_cControlProps.modelParams.box.max.z),f=new THREE.Box3(d,f);
this.m_cDefaultViewCenter=new THREE.Vector3(this.m_cControlProps.modelParams.centroid.x,this.m_cControlProps.modelParams.centroid.y,this.m_cControlProps.modelParams.centroid.z);this.m_cViewCenter=new THREE.Vector3;this.m_cViewCenter.copy(this.m_cDefaultViewCenter);d=f.size();this.m_cModelDimensions=new THREE.Vector3(d.x,d.y,d.z);this.m_cModelBoxMin=new THREE.Vector3(f.min.x,f.min.y,f.min.z);this.m_cModelBoxMax=new THREE.Vector3(f.max.x,f.max.y,f.max.z);d.x>=d.y&&d.x>=d.z?c=d.x:d.y>=d.x&&d.y>=d.z?
c=d.y:d.z>=d.y&&d.z>=d.y&&(c=d.z);f=a.height>a.width?2*Math.atan(Math.tan(THREE.Math.degToRad(this.m_cCamera.fov)/2)*a.width/a.height):THREE.Math.degToRad(this.m_cCamera.fov);this.m_rZoomDefault=1*(c/2/Math.tan(f/2)+d.z/2);this.m_rDefaultRotationX=THREE.Math.degToRad(this.m_cControlProps.floorPlan.flyPoints[0].rotX);this.m_rDefaultRotationY=THREE.Math.degToRad(this.m_cControlProps.floorPlan.flyPoints[0].rotY);this.m_rDefaultViewSphereRadius=this.m_cControlProps.floorPlan.flyPoints[0].radius;this.resetView()},
resetView:function(){this.m_rRotationX=this.m_rDefaultRotationX;this.m_rRotationY=this.m_rDefaultRotationY;this.m_rViewSphereRadius=this.m_rDefaultViewSphereRadius;this.m_cViewCenter.copy(this.m_cDefaultViewCenter);this.m_cCamera.fov=this.m_rFov;this.m_cCamera.updateProjectionMatrix();this.updateCameraPosition()},updateView:function(a,b,c,d){this.m_rRotationX=a-1E-7;this.m_rRotationY=b;this.m_rViewSphereRadius=c;d&&this.m_cViewCenter.copy(d);this.updateCameraPosition()},pan:function(a,b){var c=new THREE.Vector3(-1,
0,0),d=new THREE.Vector3(0,1,0),f=new THREE.Vector3;f.copy(this.m_cModelDimensions);c.applyQuaternion(this.m_cCamera.quaternion);d.applyQuaternion(this.m_cCamera.quaternion);f.applyQuaternion(this.m_cCamera.quaternion);var e=new THREE.Vector3;e.copy(this.m_cViewCenter);0!=a&&(c.multiplyScalar(a/this.m_cGlobalSettings.width*5),c.multiplyVectors(c,f),e.add(c));0!=b&&(d.multiplyScalar(b/this.m_cGlobalSettings.height*5),d.multiplyVectors(d,f),e.add(d));this.m_cViewCenter.copy(e);this.updateCameraPosition()},
zoom:function(a){this.m_fRadiusInTransit&&this.m_cZoomTweenObject.stop();var b=this,c=0;a==g_UPKEY?c=this.m_rViewSphereRadius/this.m_rZoomFactor:a==g_DOWNKEY&&(c=this.m_rViewSphereRadius*this.m_rZoomFactor);var d={radius:this.m_rViewSphereRadius};a={radius:c};this.m_cZoomTweenObject=new TWEEN.Tween(d);this.m_cZoomTweenObject.delay(0);this.m_cZoomTweenObject.to(a,500);this.m_cZoomTweenObject.interpolation(TWEEN.Interpolation.Linear);this.m_cZoomTweenObject.easing(TWEEN.Easing.Quadratic.Out);this.m_cZoomTweenObject.onUpdate(function(){b.m_rViewSphereRadius=
d.radius;b.updateCameraPosition()});this.m_cZoomTweenObject.onComplete(function(){b.m_rViewSphereRadius=d.radius;b.updateCameraPosition();b.m_fRadiusInTransit=!1});this.m_cZoomTweenObject.start();this.m_fRadiusInTransit=!0},updateCameraPosition:function(){var a=new THREE.Vector3;a.x=this.m_cViewCenter.x+this.m_rViewSphereRadius*Math.cos(this.m_rRotationX)*Math.sin(this.m_rRotationY)-1E-9;a.y=this.m_cViewCenter.y+this.m_rViewSphereRadius*Math.sin(this.m_rRotationX);a.z=this.m_cViewCenter.z+this.m_rViewSphereRadius*
Math.cos(this.m_rRotationX)*Math.cos(this.m_rRotationY);this.m_cCamera.position.set(a.x,a.y,a.z);this.m_cCamera.lookAt(this.m_cViewCenter)},mouseClick:function(a,b){},mouseDblClick:function(a,b){},mouseMove:function(a,b){},mouseDrag:function(a,b){this.pan(a,b)},mouseScroll:function(a){this.zoom(a)},arrowKeyPressed:function(a){},updateAnimation:function(a){},getRotationX:function(){return this.m_rRotationX},getRotationY:function(){return this.m_rRotationY},getViewSphereRadius:function(){return this.m_rViewSphereRadius},
getDefaultRotationX:function(){return this.m_rDefaultRotationX},getDefaultRotationY:function(){return this.m_rDefaultRotationY},getDefaultViewSphereRadius:function(){return this.m_rDefaultViewSphereRadius},getViewCenter:function(){return this.m_cViewCenter},getDefaultViewCenter:function(){return this.m_cDefaultViewCenter},getFov:function(){return this.m_rFov}};function getSystemSpecs(){var a="",b="",a=window.navigator.platform.toLowerCase();a.match(/ipad/i)||a.match(/iphone/i)||a.match(/ipod/i)||a.match(/pike/i)?(a="Mobile",b="iOS"):a.match(/android/i)||a.match(/linux/i)&&(a.match(/arm/i)||a.match(/msm/i))?(a="Mobile",b="Android"):a.match(/mac/i)?(a="PC",b="MacOS"):a.match(/linux/i)||a.match(/bsd/i)?(a="PC",b="Unix"):a.match(/win/i)?(a="PC",b="Windows"):b="";console.log("Your are running "+b+" on "+a+".");return[a,b]}
function getViewport(){var a,b;void 0!==typeof window.innerWidth||void 0!==typeof document.documentElement&&void 0!==typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth||(document.getElementsByTagName("body"),document.getElementsByTagName("body"));a=$(window).width();b=$(window).height()-2;return[a,b]}
function getBrowser(){var a=navigator.userAgent.toLowerCase(),b=/webkit/.test(a),c=/opera/.test(a),d=/msie/.test(a)&&!/opera/.test(a),a=/mozilla/.test(a)&&!/(compatible|webkit)/.test(a);if(b)return"webkit";if(c)return"opera";if(d)return"ie";if(a)return"firefox"}
function isWebGLAvailable(a){return window.WebGLRenderingContext?a.getContext("webgl")||a.getContext("experimental-webgl")?!0:(console.log("Browser failed to initialize WebGL. Please upgrade your graphics driver/browser."),window.location="http://get.webgl.org",!1):(console.log("WebGL is not supported by your browser. Please install a compatible browser."),window.location="http://get.webgl.org",!1)}
function enableFullScreen(a){var b=document.getElementsByTagName("body")[0],c=document;a?b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen():c.exitFullscreen?c.exitFullscreen():c.webkitExitFullscreen?c.webkitExitFullscreen():c.mozCancelFullScreen?c.mozCancelFullScreen():c.msExitFullscreen&&c.msExitFullscreen()};function CNode(){this.m_strTextureFileName=this.m_strMaterialFileName=this.m_strObjFileName=this.m_strUnitName=this.m_strStoragePath=this.m_cNodeProps=null;this.m_nType=-1;this.m_bIsTransparent=!1;this.m_cBoundingBox=this.m_c3DObject=this.m_cMaterial=this.m_cMesh=null}
CNode.prototype={constructor:CNode,initialize:function(a,b,c){this.m_cNodeProps=c;this.m_strStoragePath=a.strStoragePath;this.m_strUnitName=b;this.m_strObjFileName=this.m_cNodeProps.obj;this.m_strMaterialFileName=this.m_cNodeProps.material;this.m_strTextureFileName=this.m_cNodeProps.texture;this.m_nType=this.m_cNodeProps.type;this.m_bIsTransparent=this.m_cNodeProps.isTransparent},load:function(a){var b=new THREE.LoadingManager,c=new THREE.OBJLoader(b);b.onProgress=function(a,b,c){};var b=new THREE.LoadingManager,
d=this,b=d.m_strStoragePath+this.m_strUnitName+"/"+d.m_strObjFileName;d.m_c3DObject=new THREE.Object3D;c.load(b,function(b){b.name=d.m_strObjFilePath;var c=THREE.ImageUtils.loadTexture(d.m_strStoragePath+d.m_strUnitName+"/"+d.m_strTextureFileName),g=new THREE.MeshBasicMaterial({map:c,transparent:!0,depthTest:!0,opacity:1});b.traverse(function(b){b instanceof THREE.Mesh&&(d.m_cMesh=b,b.material=g,d.m_cMaterial=g,d.m_bIsTransparent?(b.material.opacity=0,b.renderOrder=2):b.renderOrder=1,b.material.side=
THREE.DoubleSide,b.castShadow=!0,b.receiveShadow=!0,d.m_cBoundingBox=new THREE.Box3,d.m_cBoundingBox.setFromObject(b),a(d))});b.position.set(0,0,0);d.m_c3DObject.add(b)})},get3DObjects:function(){return this.m_c3DObject},getBoundingBox:function(){return this.m_cBoundingBox},getType:function(){return this.m_nType},enableNode:function(a){this.m_c3DObject.visible=a}};Math.PI_2=.5*Math.PI;THREE.ImageUtils.crossOrigin="";function CRenderer(){this.m_rFOV=60;this.m_nWidth=320;this.m_nHeight=240;this.m_xSceneColor="#000000";this.m_cCameraManager=this.m_cDataManager=this.m_cSceneGraph=this.m_cCamera=this.m_cScene=this.m_cRenderer=null}
CRenderer.prototype={constructor:CRenderer,initEngine:function(a){this.m_nWidth=a.width;this.m_nHeight=a.height;this.m_cRenderer=isWebGLAvailable(a)?new THREE.WebGLRenderer({canvas:a,antialias:!0,alpha:!0}):new THREE.CanvasRenderer({canvas:a,antialias:!0,alpha:!0});this.m_cRenderer.setClearColor(this.m_xSceneColor,1);this.m_cRenderer.setSize(this.m_nWidth,this.m_nHeight);this.m_cRenderer.setFaceCulling(THREE.CullFaceNone);this.m_cRenderer.autoClear=!1},setupScene:function(a){this.m_cScene=new THREE.Scene;
this.m_cHUDScene=new THREE.Scene;var b=new THREE.AmbientLight(16777215);this.m_cScene.add(b);a.aspect=this.m_nWidth/this.m_nHeight;this.m_cCamera=new THREE.PerspectiveCamera(this.m_rFOV,a.aspect,5,1E4);this.m_cScene.add(this.m_cCamera);this.m_cDataManager=new CDataManager;this.m_cDataManager.initialize(a);this.m_cCameraManager=new CCameraManager;this.m_cCameraManager.initialize(a,this.m_cCamera);this.m_cSceneGraph=this.m_cDataManager.get3DObjects();this.m_cScene.add(this.m_cSceneGraph);a=this.m_cCameraManager.getDirectionArrowContainer();
null!=a&&this.m_cScene.add(a)},animateScene:function(a){this.m_cCameraManager.updateAnimation(a)},displayScene:function(a){TWEEN.update();this.m_cRenderer.clear();this.m_cRenderer.render(this.m_cScene,this.m_cCamera)},updateScene:function(a){this.m_nWidth=a.width;this.m_nHeight=a.height;this.m_cCamera.aspect=this.m_nWidth/this.m_nHeight;this.m_cCamera.updateProjectionMatrix();this.m_cRenderer.setSize(this.m_nWidth,this.m_nHeight);this.m_cCamera.updateProjectionMatrix()},mouseClick:function(a,b){this.m_cCameraManager.mouseClick(a,
b)},mouseDblClick:function(a,b){this.m_cCameraManager.mouseDblClick(a,b)},mouseMove:function(a,b){this.m_cCameraManager.mouseMove(a,b)},mouseDrag:function(a,b){this.m_cCameraManager.mouseDrag(a,b)},mouseScroll:function(a){this.m_cCameraManager.mouseScroll(a)},changeCameraMode:function(a){this.m_cCameraManager.changeCameraMode(a)},arrowKeyPressed:function(a){this.m_cCameraManager.arrowKeyPressed(a)},enableAutoTour:function(a){this.m_cCameraManager.enableAutoTour(a);this.m_cCameraManager.updateTourMode(TourMode.AUTO);
g_cUI.toggleAutoTourButton(!a)},isAutoTourEnabled:function(){return this.m_cCameraManager.isAutoTourEnabled()},moveToPoint:function(a){return this.m_cCameraManager.moveToPoint(a)}};$(function(){$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){g_cUI.fullScreen=!g_cUI.fullScreen})});var CAMERAMODE={WALKTHROUGH:0,DOLLHOUSE:1,FLOORPLAN:2};function CUI(){this.fullScreen=!1;this.cameraMode=CAMERAMODE.WALKTHROUGH;this.m_cRenderer=null}
CUI.prototype={constructor:CUI,initialize:function(a){this.m_cRenderer=g_cRenderer;this.m_cSettings=a;this.initializeUI();this.initializeMetaData()},initializeUI:function(){var a=this;$(".menu-small-button.fullscreen").on("click",function(){a.toggleFS()});$("[id=mode-walkthrough]").on("click",function(){a.setCameraMode(CAMERAMODE.WALKTHROUGH)});$("[id=mode-dollhouse]").on("click",function(){a.setCameraMode(CAMERAMODE.DOLLHOUSE)});$("[id=mode-floorplan]").on("click",function(){a.setCameraMode(CAMERAMODE.FLOORPLAN)});
$("#autotour").on("click",function(){g_cRenderer.enableAutoTour(!0)})},initializeMetaData:function(){for(var a=parseNodeProps(this.m_cSettings.strStoragePath+this.m_cSettings.cUnitProps.units[0].name+"/MetaProps.json"),b=0;b<a.metas.length;b++){var c=document.createElement("span"),d=document.createTextNode(a.metas[b].title);c.appendChild(d);c.className="nav-item";c.addEventListener("click",function(){g_cRenderer.moveToPoint(a.metas[b].startPoint)});$("#nav").append(c)}},toggleAutoTourButton:function(a){a?
($("#autotour").off("click"),$("#autotour").on("click",function(){g_cRenderer.enableAutoTour(!0)})):($("#autotour").off("click"),$("#autotour").on("click",function(){g_cRenderer.enableAutoTour(!1)}))},toggleFS:function(){enableFullScreen(!this.fullScreen)},setCameraMode:function(a){this.cameraMode=a;this.m_cRenderer.changeCameraMode(this.cameraMode);a==CAMERAMODE.WALKTHROUGH?this.displayAutoTourButton(!0):this.displayAutoTourButton(!1)},displayAutoTourButton:function(a){a?document.getElementById("autotour").style.visibility=
"visible":document.getElementById("autotour").style.visibility="hidden"},openModal:function(a){$("#"+a).fadeIn(100)},closeModal:function(a){$("#"+a).fadeOut(200)}};function CUnit(){this.m_cGlobalSettings=null;this.m_nIndex=0;this.m_cNodes=[];this.m_cBoundinBox=this.m_a3DObjectContainer=this.m_cSkyBoxMesh=this.m_cSkyBox=this.m_cControlProps=this.m_cNodeProps=null;this.m_cRoofNodes=[];this.m_cGenericNodes=[]}
CUnit.prototype={constructor:CUnit,initialize:function(a,b){this.m_cGlobalSettings=a;this.m_nIndex=b;this.m_cBoundinBox=new THREE.Box3;this.loadData(a,b);this.m_a3DObjectContainer=new THREE.Object3D;this.load3DObjects()},loadData:function(a,b){var c=this,d=a.cUnitProps.units[b].name,f=a.strStoragePath+d+"/ControlProps.json",e=parseNodeProps(a.strStoragePath+d+"/NodeProps.json"),f=parseControlProps(f),g=0;if(e){this.m_cNodeProps=a.cNodeProps=e;for(var h=0;h<e.nodes.length;h++){var k=new CNode;k.initialize(a,
d,e.nodes[h]);k.load(function(a){a=a.getBoundingBox();c.m_cBoundinBox.expandByPoint(a.min);c.m_cBoundinBox.expandByPoint(a.max);g++;g===e.nodes.length&&c.loadSkyBox()});this.m_cNodes[h]=k}this.m_cSkyBox=new THREE.Object3D;this.groupNodes()}f&&(this.m_cControlProps=f,a.cControlProps=f)},load3DObjects:function(){for(var a=0;a<this.m_cNodes.length;a++)this.m_a3DObjectContainer.add(this.m_cNodes[a].get3DObjects())},loadSkyBox:function(){var a=this.m_cGlobalSettings.strStoragePath+this.m_cGlobalSettings.cUnitProps.units[this.m_nIndex].name,
b=6*this.m_cBoundinBox.getBoundingSphere().radius,a=a+"/skybox/skybox.jpg",a=(new THREE.TextureLoader).load(a),c=1;null==a&&(c=0);a=new THREE.MeshBasicMaterial({map:a,transparent:!0,opacity:c,depthWrite:!1,side:THREE.DoubleSide});b=new THREE.SphereGeometry(b,64,64);b.applyMatrix((new THREE.Matrix4).makeScale(-1,1,1));this.m_cSkyBoxMesh=new THREE.Mesh(b,a);this.m_cSkyBoxMesh.position.set(this.m_cBoundinBox.center().x,this.m_cBoundinBox.center().y,this.m_cBoundinBox.center().z);this.m_cSkyBox.add(this.m_cSkyBoxMesh);
this.m_a3DObjectContainer.add(this.m_cSkyBox)},groupNodes:function(){for(var a=0;a<this.m_cNodes.length;a++)switch(this.m_cNodes[a].getType()){case 1:this.m_cRoofNodes.push(this.m_cNodes[a]);break;default:this.m_cGenericNodes.push(this.m_cNodes[a])}},get3DObjects:function(){return this.m_a3DObjectContainer},getControlProps:function(){return this.m_cControlProps},getSkyBox:function(){return this.m_cSkyBox},enableSkyBox:function(a){this.m_cSkyBox.visible=a},enableRoofNodes:function(a){for(var b=0;b<
this.m_cRoofNodes.length;b++)this.m_cRoofNodes[b].enableNode(a)}};function waitForCondition(a,b,c){a()===b?c():setTimeout(function(){waitForCondition(a,b,c)},250)}function easingQadraticInOut(a,b,c,d){a/=d/2;if(1>a)return c/2*a*a+b;a--;return-c/2*(a*(a-2)-1)+b}function angleDistance(a,b){var c=Math.abs(b-a);180<c&&(c=360-c);return c}function parseUnitProps(a){var b={};$.ajax({dataType:"json",url:a,async:!1,success:function(a){b=a},error:function(){b=null}});return b}
function parseNodeProps(a){var b={};$.ajax({dataType:"json",url:a,async:!1,success:function(a){b=a},error:function(){b=null}});return b}function parseControlProps(a){var b={};$.ajax({dataType:"json",url:a,async:!1,success:function(a){b=a},error:function(){b=null}});for(a=0;a<b.walkthrough.walkPoints.length;a++){var c=b.walkthrough.walkPoints[a].pointCenter,c=new THREE.Vector3(c[0],c[1],c[2]);b.walkthrough.walkPoints[a].pointCenter=c}return b}
function parseMetaProps(a){var b={};$.ajax({dataType:"json",url:a,async:!1,success:function(a){b=a},error:function(){b=null}});return b}function openModal(a){g_cUI.openModal(a)}function closeModal(a){g_cUI.closeModal(a)};var TourMode={AUTO:"Auto",MANUAL:"Manual"};function CArrowDirectionContainer(){this.m_pointIndex=-1;this.m_distance=this.m_arrowDirection=0}CArrowDirectionContainer.prototype={constructor:CArrowDirectionContainer,initialize:function(a,b,c){this.m_pointIndex=a;this.m_arrowDirection=b;this.m_distance=c},getPointIndex:function(){return this.m_pointIndex},getArrowDirection:function(){return this.m_arrowDirection},getDistance:function(){return this.m_distance}};
function CWalkthroughManipulator(){this.m_cCamera=this.m_cGlobalSettings=null;this.m_fLimitMove=!0;this.m_aTour=this.m_aWalkPoints=this.m_cCurrentPoint=this.m_cStartPoint=this.m_cControlProps=null;this.m_nTourCurrentItemIndex=-1;this.m_cDirectionArrowContainer=null;this.m_rDirectionArrowDistance=25;this.m_cDirectionArrowCenter=null;this.m_rDirectionArrowSaperation=6;this.m_rDirectionArrowActiveOpacity=1;this.m_rDirectionArrowInActiveOpacity=.65;this.m_rDirectionArrowTilt=5;this.m_aaAssignedArrows=
null;this.m_rDefaultLongitude=this.m_rDefaultLatitude=this.m_rLongitude=this.m_rLatitude=0;this.m_cRaycaster=null;this.m_fIsInTransit=!1;this.m_eTourMode=TourMode.AUTO;this.m_fIsAutoTourEnabled=!1;this.m_cSkyBox=null;this.m_rFov=60}
CWalkthroughManipulator.prototype={constructor:CWalkthroughManipulator,initialize:function(a,b){this.m_cGlobalSettings=a;this.m_cCamera=b;this.m_cControlProps=a.cControlProps;this.m_aTour=this.m_cControlProps.walkthrough.tour;this.m_aWalkPoints=this.m_cControlProps.walkthrough.walkPoints;this.m_cCurrentPoint=this.m_cStartPoint=this.m_aWalkPoints[this.m_cControlProps.walkthrough.startPoint];this.m_cCamera.vTarget=new THREE.Vector3;this.assignArrows();this.loadDirectionArrows();this.resetView();this.m_cRaycaster=
new THREE.Raycaster},mouseClick:function(a,b){!1===this.selectArrow(a/this.m_cGlobalSettings.width*2-1,2*-(b/this.m_cGlobalSettings.height)+1)&&this.mouseDblClick(a,b)},mouseDblClick:function(a,b){var c=this.computeWalkDirection(a/this.m_cGlobalSettings.width*2-1,2*-(b/this.m_cGlobalSettings.height)+1);this.walk(c)},mouseMove:function(a,b){this.highlightArrow(a/this.m_cGlobalSettings.width*2-1,2*-(b/this.m_cGlobalSettings.height)+1)},mouseDrag:function(a,b){this.updateRotation(a/this.m_cGlobalSettings.width,
b/this.m_cGlobalSettings.height)},mouseScroll:function(a){a==g_UPKEY&&this.walk(0);a==g_DOWNKEY&&this.walk(180)},arrowKeyPressed:function(a){switch(a){case g_LEFTKEY:this.turn(1/90,0);break;case g_RIGHTKEY:this.turn(-1/90,0);break;case g_UPKEY:this.walk(0);break;case g_DOWNKEY:this.walk(180)}},resetView:function(){this.m_cCamera.position.set(this.m_cStartPoint.pointCenter.x,this.m_cStartPoint.pointCenter.y,this.m_cStartPoint.pointCenter.z);this.m_cCurrentPoint=this.m_cStartPoint;this.assignPointsToDirectionArrows();
this.m_rDefaultLatitude=this.m_rLatitude=0;this.m_rDefaultLongitude=this.m_rLongitude=this.m_cControlProps.walkthrough.startOrientation;this.m_cCamera.fov=this.m_rFov;this.m_cCamera.updateProjectionMatrix();this.updateRotation(0,0)},updateRotation:function(a,b){this.m_rLongitude+=90*a;this.m_rLatitude+=90*b;180<this.m_rLongitude&&(this.m_rLongitude-=360);-180>this.m_rLongitude&&(this.m_rLongitude+=360);this.m_fFlyThroughRequired||(this.m_rLatitude=Math.max(-60,Math.min(60,this.m_rLatitude)));var c=
THREE.Math.degToRad(90-this.m_rLatitude),d=THREE.Math.degToRad(-this.m_rLongitude);this.m_cCamera.vTarget.x=Math.sin(c)*Math.sin(d);this.m_cCamera.vTarget.z=-Math.sin(c)*Math.cos(d);this.m_cCamera.vTarget.y=Math.cos(c);this.m_cCamera.vTarget.add(this.m_cCamera.position);this.m_cCamera.up=new THREE.Vector3(0,1,0);this.m_cCamera.lookAt(this.m_cCamera.vTarget);null!==this.m_cDirectionArrowContainer&&this.updateDirectionArrows()},updateRotationWithLonLat:function(a,b){this.m_rLongitude=THREE.Math.radToDeg(a);
this.m_rLatitude=THREE.Math.radToDeg(b);180<this.m_rLongitude&&(this.m_rLongitude-=360);-180>this.m_rLongitude&&(this.m_rLongitude+=360);var c=THREE.Math.degToRad(90-this.m_rLatitude),d=THREE.Math.degToRad(-this.m_rLongitude);this.m_cCamera.vTarget.x=Math.sin(c)*Math.sin(d);this.m_cCamera.vTarget.z=-Math.sin(c)*Math.cos(d);this.m_cCamera.vTarget.y=Math.cos(c);this.m_cCamera.vTarget.add(this.m_cCamera.position);this.m_cCamera.up=new THREE.Vector3(0,1,0);this.m_cCamera.lookAt(this.m_cCamera.vTarget);
null!==this.m_cDirectionArrowContainer&&this.updateDirectionArrows()},updateSettingsToPoint:function(a){this.m_cCurrentPoint=this.m_aWalkPoints[a];this.updateRotation(0,0);this.assignPointsToDirectionArrows();this.updateDirectionArrows()},loadDirectionArrows:function(){this.m_cDirectionArrowContainer=new THREE.Object3D;for(var a=THREE.ImageUtils.loadTexture("./assets/texture/arrow.png"),a=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide,blending:THREE.NormalBlending,opacity:this.m_rDirectionArrowInActiveOpacity,
transparent:!0}),b=new THREE.PlaneBufferGeometry(1,1),c=0;8>c;c++){var d=new THREE.Mesh(b,a.clone());d.scale.set(3,3,3);this.m_cDirectionArrowContainer.add(d);d.name="arrow";d.visible=!1;d.renderOrder=2}this.m_cDirectionArrowContainer.visible=!0;this.assignPointsToDirectionArrows();this.updateDirectionArrows()},updateDirectionArrows:function(){this.m_cDirectionArrowCenter=new THREE.Vector3;this.m_cDirectionArrowCenter.copy(this.m_cCamera.vTarget);this.m_cDirectionArrowCenter.sub(this.m_cCamera.position);
this.m_cDirectionArrowCenter.multiplyScalar(this.m_rDirectionArrowDistance);this.m_cDirectionArrowCenter.add(this.m_cCamera.position);for(var a=0;8>a;a++){var b=this.m_cDirectionArrowContainer.children[a],c=b.orientation;b.rotation.set(90*Math.PI/180,this.m_rDirectionArrowTilt*Math.PI/180,-c*Math.PI/180,"XZY");b.position.set(Math.cos(-c*Math.PI/180)*this.m_rDirectionArrowSaperation,-10,Math.sin(-c*Math.PI/180)*this.m_rDirectionArrowSaperation)}this.m_cDirectionArrowContainer.position.set(this.m_cDirectionArrowCenter.x,
this.m_cDirectionArrowCenter.y,this.m_cDirectionArrowCenter.z)},assignPointsToDirectionArrows:function(){for(var a=0;8>a;a++)this.m_cDirectionArrowContainer.children[a].visible=!1,this.m_cDirectionArrowContainer.children[a].material.opacity=this.m_rDirectionArrowInActiveOpacity,this.m_cDirectionArrowContainer.children[a].node=-1,this.m_cDirectionArrowContainer.children[a].orientation=45*a;for(var b=this.getAssignedArrows(),a=0;8>a;a++)0<=b[a].getPointIndex()&&(this.m_cDirectionArrowContainer.children[a].visible=
!0,this.m_cDirectionArrowContainer.children[a].node=b[a].getPointIndex(),this.m_cDirectionArrowContainer.children[a].orientation=b[a].getArrowDirection())},assignArrows:function(){this.m_aaAssignedArrows=[];var a=this;this.m_aWalkPoints.forEach(function(b){var c=b.pointCenter;b=b.pointID;var d=new THREE.Vector3(1,0,0),f=a.getConnectingNodes(b);a.m_aaAssignedArrows[b]=Array(8);for(var e=[],g=[],h=1E5,k=0;k<f.length;k++){var l=a.getPointByIndex(f[k]).pointCenter;e[k]=c.distanceTo(l);e[k]<h&&(h=e[k]);
l=new THREE.Vector3(l.x-c.x,0,l.z-c.z);g[k]=THREE.Math.radToDeg(d.angleTo(l));var n=new THREE.Vector3;n.crossVectors(d,l);0>Math.sign(n.y)&&(g[k]=360-g[k])}for(c=0;8>c;c++)a.m_aaAssignedArrows[b][c]=new CArrowDirectionContainer;d=[0,45,90,135,180,225,270,315,360];for(c=0;8>c;c++){h=-1;l=1E3;for(k=0;k<f.length;k++)22.5>angleDistance(g[k],d[c])&&e[k]<l&&(l=e[k],h=k);-1<h&&a.m_aaAssignedArrows[b][c].initialize(f[h],g[h],e[h])}for(k=0;7>k;k++)if(-1!==a.m_aaAssignedArrows[b][k].m_pointIndex)for(f=k+1;8>
f;f++)-1!==a.m_aaAssignedArrows[b][k].m_pointIndex&&-1!==a.m_aaAssignedArrows[b][f].m_pointIndex&&22.5>angleDistance(a.m_aaAssignedArrows[b][k].m_arrowDirection,a.m_aaAssignedArrows[b][f].m_arrowDirection)&&(a.m_aaAssignedArrows[b][k].m_distance<a.m_aaAssignedArrows[b][f].m_distance?a.m_aaAssignedArrows[b][f].initialize(-1,-1,-1):a.m_aaAssignedArrows[b][k].initialize(-1,-1,-1))})},selectArrow:function(a,b){if(!this.m_fIsInTransit&&!this.m_fFlyThroughRequired){var c=new THREE.Vector2;c.x=a;c.y=b;this.m_cRaycaster.setFromCamera(c,
this.m_cCamera);c=this.m_cRaycaster.intersectObjects(this.m_cDirectionArrowContainer.children);return 0<c.length&&!0===c[0].object.visible?(this.moveToPoint(c[0].object.node),!0):!1}},moveToPoint:function(a){if(!this.m_fIsInTransit){var b=this.m_cCurrentPoint.pointCenter,c=this.m_aWalkPoints[a];a=c.pointCenter;if(b!=a){this.m_fIsInTransit=!0;this.m_cDirectionArrowContainer.visible=!1;new Float32Array([0,1]);new Float32Array([b.x,b.y,b.z,a.x,a.y,a.z]);var d=this,f={x:b.x,y:b.y,z:b.z},b={x:a.x,y:a.y,
z:a.z};a=new TWEEN.Tween(f);a.delay(0);a.to(b,1E3);a.interpolation(TWEEN.Interpolation.CatmullRom);a.easing(TWEEN.Easing.Quadratic.InOut);a.onUpdate(function(){d.m_cCamera.position.set(f.x,f.y,f.z)});a.onComplete(function(){d.m_cCurrentPoint=c;d.updateRotation(0,0);d.m_cDirectionArrowContainer.visible=!0;d.assignPointsToDirectionArrows();d.updateDirectionArrows();d.m_fIsInTransit=!1});a.start()}}},highlightArrow:function(a,b){if(!this.m_fIsInTransit&&!this.m_fFlyThroughRequired){(new THREE.Vector3(a,
b,.5)).unproject(this.m_cCamera);var c=new THREE.Vector2;c.x=a;c.y=b;this.m_cRaycaster.setFromCamera(c,this.m_cCamera);c=this.m_cRaycaster.intersectObjects(this.m_cDirectionArrowContainer.children);0<c.length&&!0===c[0].object.visible?this.m_highlightedArrow!==c[0].object&&(this.m_highlightedArrow&&(this.m_highlightedArrow.material.opacity=this.m_rDirectionArrowInActiveOpacity),this.m_highlightedArrow=c[0].object,this.m_highlightedArrow.material.opacity=this.m_rDirectionArrowActiveOpacity):(this.m_highlightedArrow&&
(this.m_highlightedArrow.material.opacity=this.m_rDirectionArrowInActiveOpacity),this.m_highlightedArrow=null)}},isValidNode:function(a){return 0<=a&&this.m_aWalkPoints.length>a&&void 0!==this.m_aWalkPoints[a]},getConnectingNodes:function(a){void 0===a&&(a=this.m_cCurrentPoint.pointID);if(this.isValidNode(a))return this.m_aWalkPoints[a].pointConnections},getAssignedArrows:function(a){void 0===a&&(a=this.m_cCurrentPoint.pointID);if(this.isValidNode(a))return this.m_aaAssignedArrows[a]},getPointByIndex:function(a){if(this.isValidNode(a))return this.m_aWalkPoints[a]},
getDirectionArrowContainer:function(){return this.m_cDirectionArrowContainer},computeWalkDirection:function(a,b){if(null!=this.m_cSkyBox){(new THREE.Vector3(a,b,.5)).unproject(this.m_cCamera);var c=new THREE.Vector2;c.x=a;c.y=b;this.m_cRaycaster.setFromCamera(c,this.m_cCamera);var c=this.m_cRaycaster.intersectObjects(this.m_cSkyBox.children),d=null;0<c.length&&(d=new THREE.Vector3(c[0].point.x,c[0].point.y,c[0].point.z));if(null!=d){var f=new THREE.Vector3;f.copy(this.m_cCamera.position);var c=this.getCameraLookAt(this.m_cCamera),
d=new THREE.Vector3(d.x-f.x,0,d.z-f.z),f=THREE.Math.radToDeg(c.angleTo(d)),e=new THREE.Vector3;e.crossVectors(c,d);return f*=Math.sign(e.y)}return null}},getStartPoint:function(){return this.m_cStartPoint},getStartOrientation:function(){return this.m_cControlProps.walkthrough.startOrientation},walk:function(a){if(null!==a&&!this.m_fIsInTransit&&!this.m_fFlyThroughRequired){for(var b=this.m_cCurrentPoint.pointCenter,c=this.getCameraLookAt(this.m_cCamera),d=[],f=this.getAssignedArrows(),e=0;e<f.length;e++)0<=
f[e].m_pointIndex&&d.push(f[e].m_pointIndex);for(var f=[],e=[],g=0;g<d.length;g++){var h=this.m_aWalkPoints[parseInt(d[g])].pointCenter;f[g]=b.distanceTo(h);h=new THREE.Vector3(h.x-b.x,0,h.z-b.z);e[g]=THREE.Math.radToDeg(c.angleTo(h));var k=new THREE.Vector3;k.crossVectors(c,h);e[g]*=Math.sign(k.y)}b=-1;c=1E3;for(g=0;g<d.length;g++)30>this.angleDistance(a,e[g])&&f[g]<c&&(c=f[g],b=g);-1<b&&this.moveToPoint(d[b])}},turn:function(a,b){this.m_fFlyThroughRequired||this.updateRotation(a,b)},angleDistance:function(a,
b){var c=Math.abs(b-a);180<c&&(c=360-c);return c},getCameraLookAt:function(a){var b=new THREE.Vector3(0,0,-1);b.applyEuler(a.rotation,a.rotation.order);return b},enableAutoTour:function(a){this.m_fIsAutoTourEnabled=a;a||(this.m_nTourCurrentItemIndex=-1)},isAutoTourEnabled:function(){return this.m_fIsAutoTourEnabled},getTourMode:function(){return this.m_eTourMode},updateTourMode:function(a){this.m_fIsAutoTourEnabled&&(this.m_eTourMode=a,this.m_eTourMode==TourMode.AUTO&&this.continueAutoWalk())},updateAnimation:function(a){if(this.m_fTransitAnim)if(this.m_rTime+=
Math.min(a,25)/1E3,1<=this.m_rTime)this.m_fTransitAnim=!1;else{a=easingQadraticInOut(this.m_rTime,0,1,1);var b=new THREE.Vector3;b.copy(this.m_vGrad);b.normalize();b.multiplyScalar(a*this.m_rTransitDistScale);b.add(this.m_cCurrentPoint.pointCenter);this.m_cCamera.position.set(b.x,b.y,b.z)}else!isNaN(a)&&this.m_fIsAutoTourEnabled&&(this.m_eTourMode==TourMode.AUTO?(this.m_rTime+=Math.min(a,25)/1500,2<=this.m_rTime&&this.continueAutoWalk()):(this.m_rTourTimer+=a,3E3<this.m_rTourTimer&&(this.m_rTourTimer=
0,this.updateTourMode(TourMode.AUTO))))},continueAutoWalk:function(){if(!this.m_fIsInTransit&&this.m_nTourCurrentItemIndex<this.m_aTour.length-1&&this.isAutoTourEnabled()){var a=this.m_cCurrentPoint,b=a.pointCenter;-1==this.m_nTourCurrentItemIndex&&(this.m_nTourCurrentItemIndex=this.m_aTour.indexOf(a.pointID));var c=this.m_aTour[this.m_nTourCurrentItemIndex+1],a=this.m_aWalkPoints.findIndex(function(a){return a.pointID==c}),a=this.m_aWalkPoints[a],d=a.pointCenter,b=new THREE.Vector3(d.x-b.x,d.y-b.y,
d.z-b.z),b=this.computeAngleWithCamera(b);15<Math.abs(b)?this.turn(0<b?.005:-.005,0):(this.moveToPoint(a.pointID),this.m_rTime=0,this.m_nTourCurrentItemIndex==this.m_aTour.length-2&&(this.m_nTourCurrentItemIndex=-1),this.m_nTourCurrentItemIndex++)}},computeAngleWithCamera:function(a){var b=this.getCameraLookAt(this.m_cCamera),c=THREE.Math.radToDeg(Math.acos((a.x*b.x+a.z*b.z)/(Math.sqrt(a.x*a.x+a.z*a.z)*Math.sqrt(b.x*b.x+b.z*b.z))));return 0>b.z*a.x-a.z*b.x?-c:c},setSkyBox:function(a){this.m_cSkyBox=
a},getLongitude:function(){return this.m_rLongitude},getLatitude:function(){return this.m_rLatitude},getFov:function(){return this.m_rFov},enableDirectionArrows:function(a){this.m_cDirectionArrowContainer.visible=a}};THREE.OBJLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.materials=null;this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,
face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};
THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(a,b,c,d){var f=this,e=new THREE.XHRLoader(f.manager);e.setPath(this.path);e.load(a,function(a){b(f.parse(a))},c,d)},setPath:function(a){this.path=a},setMaterials:function(a){this.materials=a},_createParserState:function(){var a={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(a,c){if(this.object&&!1===this.object.fromDeclaration)this.object.name=a,this.object.fromDeclaration=!1!==c;else{this.object&&
"function"===typeof this.object._finalize&&this.object._finalize();var d=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object={name:a||"",fromDeclaration:!1!==c,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(a,b){var c=this._finalize(!1);c&&(c.inherited||0>=c.groupCount)&&this.materials.splice(c.index,1);c={index:this.materials.length,name:a||"",mtllib:Array.isArray(b)&&0<b.length?b[b.length-1]:"",smooth:void 0!==
c?c.smooth:this.smooth,groupStart:void 0!==c?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){return{index:"number"===typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:this.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1}}};this.materials.push(c);return c},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(a){var b=this.currentMaterial();b&&-1===b.groupEnd&&(b.groupEnd=this.geometry.vertices.length/
3,b.groupCount=b.groupEnd-b.groupStart,b.inherited=!1);!1!==a&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth});return b}};d&&d.name&&"function"===typeof d.clone&&(d=d.clone(0),d.inherited=!0,this.object.materials.push(d));this.objects.push(this.object)}},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize()},parseVertexIndex:function(a,c){var d=parseInt(a,10);return 3*(0<=d?d-1:d+c/3)},parseNormalIndex:function(a,c){var d=
parseInt(a,10);return 3*(0<=d?d-1:d+c/3)},parseUVIndex:function(a,c){var d=parseInt(a,10);return 2*(0<=d?d-1:d+c/2)},addVertex:function(a,c,d){var f=this.vertices,e=this.object.geometry.vertices;e.push(f[a+0]);e.push(f[a+1]);e.push(f[a+2]);e.push(f[c+0]);e.push(f[c+1]);e.push(f[c+2]);e.push(f[d+0]);e.push(f[d+1]);e.push(f[d+2])},addVertexLine:function(a){var c=this.vertices,d=this.object.geometry.vertices;d.push(c[a+0]);d.push(c[a+1]);d.push(c[a+2])},addNormal:function(a,c,d){var f=this.normals,e=
this.object.geometry.normals;e.push(f[a+0]);e.push(f[a+1]);e.push(f[a+2]);e.push(f[c+0]);e.push(f[c+1]);e.push(f[c+2]);e.push(f[d+0]);e.push(f[d+1]);e.push(f[d+2])},addUV:function(a,c,d){var f=this.uvs,e=this.object.geometry.uvs;e.push(f[a+0]);e.push(f[a+1]);e.push(f[c+0]);e.push(f[c+1]);e.push(f[d+0]);e.push(f[d+1])},addUVLine:function(a){var c=this.uvs,d=this.object.geometry.uvs;d.push(c[a+0]);d.push(c[a+1])},addFace:function(a,c,d,f,e,g,h,k,l,n,q,r){var m=this.vertices.length;a=this.parseVertexIndex(a,
m);c=this.parseVertexIndex(c,m);d=this.parseVertexIndex(d,m);void 0===f?this.addVertex(a,c,d):(m=this.parseVertexIndex(f,m),this.addVertex(a,c,m),this.addVertex(c,d,m));void 0!==e&&(m=this.uvs.length,a=this.parseUVIndex(e,m),c=this.parseUVIndex(g,m),d=this.parseUVIndex(h,m),void 0===f?this.addUV(a,c,d):(m=this.parseUVIndex(k,m),this.addUV(a,c,m),this.addUV(c,d,m)));void 0!==l&&(e=this.normals.length,a=this.parseNormalIndex(l,e),c=l===n?a:this.parseNormalIndex(n,e),d=l===q?a:this.parseNormalIndex(q,
e),void 0===f?this.addNormal(a,c,d):(m=this.parseNormalIndex(r,e),this.addNormal(a,c,m),this.addNormal(c,d,m)))},addLineGeometry:function(a,c){this.object.geometry.type="Line";for(var d=this.vertices.length,f=this.uvs.length,e=0,g=a.length;e<g;e++)this.addVertexLine(this.parseVertexIndex(a[e],d));d=0;for(g=c.length;d<g;d++)this.addUVLine(this.parseUVIndex(c[d],f))}};a.startObject("",!1);return a},parse:function(a){var b=this._createParserState();-1!==a.indexOf("\r\n")&&(a=a.replace("\r\n","\n"));
var c=a.split("\n"),d="",f="",f="",f=0,e=[],g="function"===typeof"".trimLeft;a=0;for(var h=c.length;a<h;a++)if(d=c[a],d=g?d.trimLeft():d.trim(),f=d.length,0!==f&&(f=d.charAt(0),"#"!==f))if("v"===f)if(f=d.charAt(1)," "===f&&null!==(e=this.regexp.vertex_pattern.exec(d)))b.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));else if("n"===f&&null!==(e=this.regexp.normal_pattern.exec(d)))b.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));else if("t"===f&&null!==(e=this.regexp.uv_pattern.exec(d)))b.uvs.push(parseFloat(e[1]),
parseFloat(e[2]));else throw Error("Unexpected vertex/normal/uv line: '"+d+"'");else if("f"===f)if(null!==(e=this.regexp.face_vertex_uv_normal.exec(d)))b.addFace(e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],e[3],e[6],e[9],e[12]);else if(null!==(e=this.regexp.face_vertex_uv.exec(d)))b.addFace(e[1],e[3],e[5],e[7],e[2],e[4],e[6],e[8]);else if(null!==(e=this.regexp.face_vertex_normal.exec(d)))b.addFace(e[1],e[3],e[5],e[7],void 0,void 0,void 0,void 0,e[2],e[4],e[6],e[8]);else if(null!==(e=this.regexp.face_vertex.exec(d)))b.addFace(e[1],
e[2],e[3],e[4]);else throw Error("Unexpected face line: '"+d+"'");else if("l"===f){var f=d.substring(1).trim().split(" "),k=[],l=[];if(-1===d.indexOf("/"))k=f;else for(var d=0,n=f.length;d<n;d++){var q=f[d].split("/");""!==q[0]&&k.push(q[0]);""!==q[1]&&l.push(q[1])}b.addLineGeometry(k,l)}else if(null!==(e=this.regexp.object_pattern.exec(d)))d=e[0].substr(1).trim(),b.startObject(d);else if(this.regexp.material_use_pattern.test(d))b.object.startMaterial(d.substring(7).trim(),b.materialLibraries);else if(this.regexp.material_library_pattern.test(d))b.materialLibraries.push(d.substring(7).trim());
else if(null!==(e=this.regexp.smoothing_pattern.exec(d))){if(d=e[1].trim().toLowerCase(),b.object.smooth="1"===d||"on"===d,d=b.object.currentMaterial())d.smooth=b.object.smooth}else if("\x00"!==d)throw Error("Unexpected line: '"+d+"'");b.finalize();c=new THREE.Group;c.materialLibraries=[].concat(b.materialLibraries);a=0;for(h=b.objects.length;a<h;a++)if(e=b.objects[a],d=e.geometry,k=e.materials,g="Line"===d.type,0!==d.vertices.length){f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.BufferAttribute(new Float32Array(d.vertices),
3));0<d.normals.length?f.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(d.normals),3)):f.computeVertexNormals();0<d.uvs.length&&f.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(d.uvs),2));l=[];n=0;for(q=k.length;n<q;n++){var r=k[n],d=void 0;if(null!==this.materials&&(d=this.materials.create(r.name),g&&d&&!(d instanceof THREE.LineBasicMaterial))){var m=new THREE.LineBasicMaterial;m.copy(d);d=m}d||(d=g?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,d.name=r.name);
d.shading=r.smooth?THREE.SmoothShading:THREE.FlatShading;l.push(d)}if(1<l.length){n=0;for(q=k.length;n<q;n++)r=k[n],f.addGroup(r.groupStart,r.groupCount,n);d=new THREE.MultiMaterial(l);g=g?new THREE.Line(f,d):new THREE.Mesh(f,d)}else g=g?new THREE.Line(f,l[0]):new THREE.Mesh(f,l[0]);g.name=e.name;c.add(g)}return c}};(function(){function a(){switch(window.screen.orientation||window.screen.mozOrientation){case "landscape-primary":return 90;case "landscape-secondary":return-90;case "portrait-secondary":return 180;case "portrait-primary":return 0}return window.orientation||0}var b={},c=window.orientation||0;window.addEventListener("deviceorientation",function(a){b=a},!1);window.addEventListener("orientationchange",function(){c=a()},!1);THREE.DeviceOrientationControls=function(a){this.object=a;this.object.rotation.reorder("YXZ");
this.freeze=!0;this.movementSpeed=1;this.rollSpeed=.005;this.autoAlign=!0;this.autoForward=!1;this.orient=this.gamma=this.beta=this.alpha=0;this.alignQuaternion=new THREE.Quaternion;this.orientationQuaternion=new THREE.Quaternion;var f=new THREE.Quaternion,e=new THREE.Quaternion,g=new THREE.Vector3,h=new THREE.Matrix4,k=new THREE.Euler(0,0,0,"YXZ"),l=new THREE.Quaternion,n=new THREE.Vector3(0,0,1),q=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,0),m=new THREE.Euler,t=new THREE.Quaternion,p=new THREE.Quaternion(-Math.sqrt(.5),
0,0,Math.sqrt(.5));this.update=function(a){return function(a){this.freeze||(this.alpha=b.gamma?THREE.Math.degToRad(b.alpha):0,this.beta=b.beta?THREE.Math.degToRad(b.beta):0,this.gamma=b.gamma?THREE.Math.degToRad(b.gamma):0,this.orient=c?THREE.Math.degToRad(c):0,m.set(this.beta,this.alpha,-this.gamma,"YXZ"),f.setFromEuler(m),e.slerp(f,.5),this.autoAlign?this.orientationQuaternion.copy(f):this.orientationQuaternion.copy(e),this.orientationQuaternion.multiply(p),this.orientationQuaternion.multiply(t.setFromAxisAngle(n,
-this.orient)),this.object.quaternion.copy(this.alignQuaternion),this.object.quaternion.multiply(this.orientationQuaternion),this.autoForward&&(g.set(0,0,-1).applyQuaternion(this.object.quaternion,"ZXY").setLength(this.movementSpeed/50),this.object.position.add(g)),this.autoAlign&&0!==this.alpha&&(this.autoAlign=!1,this.align()))}}();this.align=function(){g.set(0,0,-1).applyQuaternion(l.copy(this.orientationQuaternion).inverse(),"ZXY");k.setFromQuaternion(l.setFromRotationMatrix(h.lookAt(g,r,q)));
k.set(0,k.y,0);this.alignQuaternion.setFromEuler(k)};this.connect=function(){this.freeze=!1};this.disconnect=function(){this.freze=!0}}})();THREE.StereoEffect=function(a){this.separation=0;this.focalLength=15;var b,c,d=new THREE.Vector3,f=new THREE.Quaternion,e=new THREE.Vector3,g=new THREE.PerspectiveCamera,h=new THREE.PerspectiveCamera,k,l,n,q,r,m,t,p,y,w;a.autoClear=!1;this.setSize=function(d,e){b=d/2;c=e;a.setSize(d,e)};this.render=function(z,x){z.updateMatrixWorld();void 0===x.parent&&x.updateMatrixWorld();x.matrixWorld.decompose(d,f,e);k=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(x.fov))));m=x.near/this.focalLength;
p=Math.tan(.5*THREE.Math.degToRad(k))*this.focalLength;t=.5*p*x.aspect;q=p*m;r=-q;y=(t+this.separation/2)/(2*t);w=1-y;l=2*t*m*w;n=2*t*m*y;g.projectionMatrix.makeFrustum(-l,n,r,q,x.near,x.far);g.position.copy(d);g.quaternion.copy(f);g.translateX(-this.separation/2);h.projectionMatrix.makeFrustum(-n,l,r,q,x.near,x.far);h.position.copy(d);h.quaternion.copy(f);h.translateX(this.separation/2);a.setViewport(0,0,2*b,c);a.setViewport(0,0,b,c);a.render(z,g);a.setViewport(b,0,b,c);a.render(z,h)}};
